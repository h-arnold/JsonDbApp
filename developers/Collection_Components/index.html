
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A document database implemented in Google Apps Script using the Google Drive API">
      
      
        <meta name="author" content="h-arnold">
      
      
        <link rel="canonical" href="https://h-arnold.github.io/JsonDbApp/developers/Collection_Components/">
      
      
        <link rel="prev" href="../UpdateEngine/">
      
      
        <link rel="next" href="../Infrastructure_Components/">
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Collection Components - JsonDbApp Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#collection-components-developer-guide" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="JsonDbApp Documentation" class="md-header__button md-logo" aria-label="JsonDbApp Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            JsonDbApp Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Collection Components
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/h-arnold/JsonDbApp" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    h-arnold/JsonDbApp
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../Quick_Start/" class="md-tabs__link">
          
  
  
  Getting Started

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../Querying/" class="md-tabs__link">
          
  
  
  User Guide

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
  
  Developer Documentation

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../release-notes/release-notes-v0.0.4/" class="md-tabs__link">
          
  
  
  Release Notes

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="JsonDbApp Documentation" class="md-nav__button md-logo" aria-label="JsonDbApp Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    JsonDbApp Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/h-arnold/JsonDbApp" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    h-arnold/JsonDbApp
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Getting Started
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Quick_Start/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quick Start
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Examples
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    User Guide
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    User Guide
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Querying/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Querying
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Updates/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Updates
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Developer Documentation
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Developer Documentation
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Architecture
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Architecture
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Database/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Database
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DatabaseConfig/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DatabaseConfig
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../MasterIndex/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MasterIndex
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" checked>
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Components
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Components
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../QueryEngine/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    QueryEngine
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../UpdateEngine/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    UpdateEngine
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Collection Components
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Collection Components
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        Overview
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        Architecture
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#current-limitations-section-5" class="md-nav__link">
    <span class="md-ellipsis">
      
        Current Limitations (Section 5)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#collection" class="md-nav__link">
    <span class="md-ellipsis">
      
        Collection
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Collection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#purpose" class="md-nav__link">
    <span class="md-ellipsis">
      
        Purpose
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#constructor" class="md-nav__link">
    <span class="md-ellipsis">
      
        Constructor
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#public-methods" class="md-nav__link">
    <span class="md-ellipsis">
      
        Public Methods
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Public Methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#insertonedoc-object-object" class="md-nav__link">
    <span class="md-ellipsis">
      
        insertOne(doc: Object): Object
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#findonefilter-object-objectnull" class="md-nav__link">
    <span class="md-ellipsis">
      
        findOne(filter?: Object): Object|null
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#findfilter-object-array" class="md-nav__link">
    <span class="md-ellipsis">
      
        find(filter?: Object): Array
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#updateonefilter-object-update-object-object" class="md-nav__link">
    <span class="md-ellipsis">
      
        updateOne(filter: Object, update: Object): Object
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#updatemanyfilter-object-update-object-object" class="md-nav__link">
    <span class="md-ellipsis">
      
        updateMany(filter: Object, update: Object): Object
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#replaceonefilter-object-replacement-object-object" class="md-nav__link">
    <span class="md-ellipsis">
      
        replaceOne(filter: Object, replacement: Object): Object
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deleteonefilter-object-object" class="md-nav__link">
    <span class="md-ellipsis">
      
        deleteOne(filter: Object): Object
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#countdocumentsfilter-object-number" class="md-nav__link">
    <span class="md-ellipsis">
      
        countDocuments(filter?: Object): number
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getname-string" class="md-nav__link">
    <span class="md-ellipsis">
      
        getName(): string
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getmetadata-object" class="md-nav__link">
    <span class="md-ellipsis">
      
        getMetadata(): Object
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#isdirty-boolean" class="md-nav__link">
    <span class="md-ellipsis">
      
        isDirty(): boolean
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#save-void" class="md-nav__link">
    <span class="md-ellipsis">
      
        save(): void
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lazy-loading" class="md-nav__link">
    <span class="md-ellipsis">
      
        Lazy Loading
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#collectionmetadata" class="md-nav__link">
    <span class="md-ellipsis">
      
        CollectionMetadata
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CollectionMetadata">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#purpose_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Purpose
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#constructor_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Constructor
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#public-methods_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Public Methods
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Public Methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#updatelastmodified-void" class="md-nav__link">
    <span class="md-ellipsis">
      
        updateLastModified(): void
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#touch-void" class="md-nav__link">
    <span class="md-ellipsis">
      
        touch(): void
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#incrementdocumentcount-void" class="md-nav__link">
    <span class="md-ellipsis">
      
        incrementDocumentCount(): void
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#decrementdocumentcount-void" class="md-nav__link">
    <span class="md-ellipsis">
      
        decrementDocumentCount(): void
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setdocumentcountcount-number-void" class="md-nav__link">
    <span class="md-ellipsis">
      
        setDocumentCount(count: number): void
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getmodificationtoken-string-null" class="md-nav__link">
    <span class="md-ellipsis">
      
        getModificationToken(): string | null
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setmodificationtokentoken-string-null-void" class="md-nav__link">
    <span class="md-ellipsis">
      
        setModificationToken(token: string | null): void
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getlockstatus-object-null" class="md-nav__link">
    <span class="md-ellipsis">
      
        getLockStatus(): Object | null
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setlockstatuslockstatus-object-null-void" class="md-nav__link">
    <span class="md-ellipsis">
      
        setLockStatus(lockStatus: Object | null): void
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tojson-object" class="md-nav__link">
    <span class="md-ellipsis">
      
        toJSON(): Object
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clone-collectionmetadata" class="md-nav__link">
    <span class="md-ellipsis">
      
        clone(): CollectionMetadata
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#static-methods" class="md-nav__link">
    <span class="md-ellipsis">
      
        Static Methods
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Static Methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#static-fromjsonobj-object-collectionmetadata" class="md-nav__link">
    <span class="md-ellipsis">
      
        static fromJSON(obj: Object): CollectionMetadata
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#static-createname-string-fileid-string-collectionmetadata" class="md-nav__link">
    <span class="md-ellipsis">
      
        static create(name: string, fileId: string): CollectionMetadata
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#documentoperations" class="md-nav__link">
    <span class="md-ellipsis">
      
        DocumentOperations
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DocumentOperations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#purpose_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Purpose
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#constructor_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Constructor
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#public-methods_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Public Methods
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Public Methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#insertdocumentdoc-object-object" class="md-nav__link">
    <span class="md-ellipsis">
      
        insertDocument(doc: Object): Object
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#finddocumentbyidid-string-objectnull" class="md-nav__link">
    <span class="md-ellipsis">
      
        findDocumentById(id: string): Object|null
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#findalldocuments-arrayobject" class="md-nav__link">
    <span class="md-ellipsis">
      
        findAllDocuments(): Array&lt;Object&gt;
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#updatedocumentid-string-updatedata-object-object" class="md-nav__link">
    <span class="md-ellipsis">
      
        updateDocument(id: string, updateData: Object): Object
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deletedocumentid-string-object" class="md-nav__link">
    <span class="md-ellipsis">
      
        deleteDocument(id: string): Object
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#countdocuments-number" class="md-nav__link">
    <span class="md-ellipsis">
      
        countDocuments(): number
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#documentexistsid-string-boolean" class="md-nav__link">
    <span class="md-ellipsis">
      
        documentExists(id: string): boolean
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#findbyqueryquery-object-objectnull" class="md-nav__link">
    <span class="md-ellipsis">
      
        findByQuery(query: Object): Object|null
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#findmultiplebyqueryquery-object-arrayobject" class="md-nav__link">
    <span class="md-ellipsis">
      
        findMultipleByQuery(query: Object): Array&lt;Object&gt;
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#countbyqueryquery-object-number" class="md-nav__link">
    <span class="md-ellipsis">
      
        countByQuery(query: Object): number
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#updatedocumentwithoperatorsid-string-updateops-object-object" class="md-nav__link">
    <span class="md-ellipsis">
      
        updateDocumentWithOperators(id: string, updateOps: Object): Object
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#updatedocumentbyqueryquery-object-updateops-object-number" class="md-nav__link">
    <span class="md-ellipsis">
      
        updateDocumentByQuery(query: Object, updateOps: Object): number
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#replacedocumentid-string-doc-object-object" class="md-nav__link">
    <span class="md-ellipsis">
      
        replaceDocument(id: string, doc: Object): Object
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#replacedocumentbyqueryquery-object-doc-object-number" class="md-nav__link">
    <span class="md-ellipsis">
      
        replaceDocumentByQuery(query: Object, doc: Object): number
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#private-methods" class="md-nav__link">
    <span class="md-ellipsis">
      
        Private Methods
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Infrastructure_Components/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Infrastructure Components
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" >
        
          
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Testing
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Testing
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Testing_Framework/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Testing Framework
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_5" >
        
          
          <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Diagrams
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Diagrams
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Class_Diagrams/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Class Diagrams
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Release Notes
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Release Notes
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/release-notes-v0.0.4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Version 0.0.4
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/release-notes-v0.0.3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Version 0.0.3
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        Overview
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        Architecture
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#current-limitations-section-5" class="md-nav__link">
    <span class="md-ellipsis">
      
        Current Limitations (Section 5)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#collection" class="md-nav__link">
    <span class="md-ellipsis">
      
        Collection
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Collection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#purpose" class="md-nav__link">
    <span class="md-ellipsis">
      
        Purpose
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#constructor" class="md-nav__link">
    <span class="md-ellipsis">
      
        Constructor
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#public-methods" class="md-nav__link">
    <span class="md-ellipsis">
      
        Public Methods
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Public Methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#insertonedoc-object-object" class="md-nav__link">
    <span class="md-ellipsis">
      
        insertOne(doc: Object): Object
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#findonefilter-object-objectnull" class="md-nav__link">
    <span class="md-ellipsis">
      
        findOne(filter?: Object): Object|null
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#findfilter-object-array" class="md-nav__link">
    <span class="md-ellipsis">
      
        find(filter?: Object): Array
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#updateonefilter-object-update-object-object" class="md-nav__link">
    <span class="md-ellipsis">
      
        updateOne(filter: Object, update: Object): Object
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#updatemanyfilter-object-update-object-object" class="md-nav__link">
    <span class="md-ellipsis">
      
        updateMany(filter: Object, update: Object): Object
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#replaceonefilter-object-replacement-object-object" class="md-nav__link">
    <span class="md-ellipsis">
      
        replaceOne(filter: Object, replacement: Object): Object
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deleteonefilter-object-object" class="md-nav__link">
    <span class="md-ellipsis">
      
        deleteOne(filter: Object): Object
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#countdocumentsfilter-object-number" class="md-nav__link">
    <span class="md-ellipsis">
      
        countDocuments(filter?: Object): number
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getname-string" class="md-nav__link">
    <span class="md-ellipsis">
      
        getName(): string
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getmetadata-object" class="md-nav__link">
    <span class="md-ellipsis">
      
        getMetadata(): Object
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#isdirty-boolean" class="md-nav__link">
    <span class="md-ellipsis">
      
        isDirty(): boolean
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#save-void" class="md-nav__link">
    <span class="md-ellipsis">
      
        save(): void
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lazy-loading" class="md-nav__link">
    <span class="md-ellipsis">
      
        Lazy Loading
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#collectionmetadata" class="md-nav__link">
    <span class="md-ellipsis">
      
        CollectionMetadata
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CollectionMetadata">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#purpose_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Purpose
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#constructor_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Constructor
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#public-methods_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Public Methods
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Public Methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#updatelastmodified-void" class="md-nav__link">
    <span class="md-ellipsis">
      
        updateLastModified(): void
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#touch-void" class="md-nav__link">
    <span class="md-ellipsis">
      
        touch(): void
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#incrementdocumentcount-void" class="md-nav__link">
    <span class="md-ellipsis">
      
        incrementDocumentCount(): void
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#decrementdocumentcount-void" class="md-nav__link">
    <span class="md-ellipsis">
      
        decrementDocumentCount(): void
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setdocumentcountcount-number-void" class="md-nav__link">
    <span class="md-ellipsis">
      
        setDocumentCount(count: number): void
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getmodificationtoken-string-null" class="md-nav__link">
    <span class="md-ellipsis">
      
        getModificationToken(): string | null
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setmodificationtokentoken-string-null-void" class="md-nav__link">
    <span class="md-ellipsis">
      
        setModificationToken(token: string | null): void
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getlockstatus-object-null" class="md-nav__link">
    <span class="md-ellipsis">
      
        getLockStatus(): Object | null
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setlockstatuslockstatus-object-null-void" class="md-nav__link">
    <span class="md-ellipsis">
      
        setLockStatus(lockStatus: Object | null): void
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tojson-object" class="md-nav__link">
    <span class="md-ellipsis">
      
        toJSON(): Object
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clone-collectionmetadata" class="md-nav__link">
    <span class="md-ellipsis">
      
        clone(): CollectionMetadata
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#static-methods" class="md-nav__link">
    <span class="md-ellipsis">
      
        Static Methods
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Static Methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#static-fromjsonobj-object-collectionmetadata" class="md-nav__link">
    <span class="md-ellipsis">
      
        static fromJSON(obj: Object): CollectionMetadata
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#static-createname-string-fileid-string-collectionmetadata" class="md-nav__link">
    <span class="md-ellipsis">
      
        static create(name: string, fileId: string): CollectionMetadata
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#documentoperations" class="md-nav__link">
    <span class="md-ellipsis">
      
        DocumentOperations
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DocumentOperations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#purpose_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Purpose
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#constructor_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Constructor
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#public-methods_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Public Methods
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Public Methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#insertdocumentdoc-object-object" class="md-nav__link">
    <span class="md-ellipsis">
      
        insertDocument(doc: Object): Object
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#finddocumentbyidid-string-objectnull" class="md-nav__link">
    <span class="md-ellipsis">
      
        findDocumentById(id: string): Object|null
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#findalldocuments-arrayobject" class="md-nav__link">
    <span class="md-ellipsis">
      
        findAllDocuments(): Array&lt;Object&gt;
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#updatedocumentid-string-updatedata-object-object" class="md-nav__link">
    <span class="md-ellipsis">
      
        updateDocument(id: string, updateData: Object): Object
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deletedocumentid-string-object" class="md-nav__link">
    <span class="md-ellipsis">
      
        deleteDocument(id: string): Object
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#countdocuments-number" class="md-nav__link">
    <span class="md-ellipsis">
      
        countDocuments(): number
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#documentexistsid-string-boolean" class="md-nav__link">
    <span class="md-ellipsis">
      
        documentExists(id: string): boolean
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#findbyqueryquery-object-objectnull" class="md-nav__link">
    <span class="md-ellipsis">
      
        findByQuery(query: Object): Object|null
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#findmultiplebyqueryquery-object-arrayobject" class="md-nav__link">
    <span class="md-ellipsis">
      
        findMultipleByQuery(query: Object): Array&lt;Object&gt;
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#countbyqueryquery-object-number" class="md-nav__link">
    <span class="md-ellipsis">
      
        countByQuery(query: Object): number
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#updatedocumentwithoperatorsid-string-updateops-object-object" class="md-nav__link">
    <span class="md-ellipsis">
      
        updateDocumentWithOperators(id: string, updateOps: Object): Object
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#updatedocumentbyqueryquery-object-updateops-object-number" class="md-nav__link">
    <span class="md-ellipsis">
      
        updateDocumentByQuery(query: Object, updateOps: Object): number
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#replacedocumentid-string-doc-object-object" class="md-nav__link">
    <span class="md-ellipsis">
      
        replaceDocument(id: string, doc: Object): Object
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#replacedocumentbyqueryquery-object-doc-object-number" class="md-nav__link">
    <span class="md-ellipsis">
      
        replaceDocumentByQuery(query: Object, doc: Object): number
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#private-methods" class="md-nav__link">
    <span class="md-ellipsis">
      
        Private Methods
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="collection-components-developer-guide">Collection Components Developer Guide<a class="headerlink" href="#collection-components-developer-guide" title="Permanent link">&para;</a></h1>
<p>This document explains the role, API surface and usage patterns for the Collection, CollectionMetadata, and DocumentOperations classes in JsonDbApp. These three classes work together to provide MongoDB-compatible collection operations with Google Drive persistence.</p>
<ul>
<li><a href="#collection-components-developer-guide">Collection Components Developer Guide</a></li>
<li><a href="#overview">Overview</a><ul>
<li><a href="#architecture">Architecture</a></li>
<li><a href="#current-limitations-section-5">Current Limitations (Section 5)</a></li>
</ul>
</li>
<li><a href="#collection">Collection</a><ul>
<li><a href="#purpose">Purpose</a></li>
<li><a href="#constructor">Constructor</a></li>
<li><a href="#public-methods">Public Methods</a></li>
<li><a href="#insertonedoc-object-object">insertOne(doc: Object): Object</a></li>
<li><a href="#findonefilter-object-objectnull">findOne(filter?: Object): Object|null</a></li>
<li><a href="#findfilter-object-array">find(filter?: Object): Array</a></li>
<li><a href="#updateonefilter-object-update-object-object">updateOne(filter: Object, update: Object): Object</a></li>
<li><a href="#updatemanyfilter-object-update-object-object">updateMany(filter: Object, update: Object): Object</a></li>
<li><a href="#replaceonefilter-object-replacement-object-object">replaceOne(filter: Object, replacement: Object): Object</a></li>
<li><a href="#deleteonefilter-object-object">deleteOne(filter: Object): Object</a></li>
<li><a href="#countdocumentsfilter-object-number">countDocuments(filter?: Object): number</a></li>
<li><a href="#getname-string">getName(): string</a></li>
<li><a href="#getmetadata-object">getMetadata(): Object</a></li>
<li><a href="#isdirty-boolean">isDirty(): boolean</a></li>
<li><a href="#save-void">save(): void</a></li>
<li><a href="#lazy-loading">Lazy Loading</a></li>
</ul>
</li>
<li><a href="#collectionmetadata">CollectionMetadata</a><ul>
<li><a href="#purpose-1">Purpose</a></li>
<li><a href="#constructor-1">Constructor</a></li>
<li><a href="#public-methods-1">Public Methods</a></li>
<li><a href="#updatelastmodified-void"><code>updateLastModified(): void</code></a></li>
<li><a href="#touch-void"><code>touch(): void</code></a></li>
<li><a href="#incrementdocumentcount-void"><code>incrementDocumentCount(): void</code></a></li>
<li><a href="#decrementdocumentcount-void"><code>decrementDocumentCount(): void</code></a></li>
<li><a href="#setdocumentcountcount-number-void"><code>setDocumentCount(count: number): void</code></a></li>
<li><a href="#getmodificationtoken-string--null"><code>getModificationToken(): string | null</code></a></li>
<li><a href="#setmodificationtokentoken-string--null-void"><code>setModificationToken(token: string | null): void</code></a></li>
<li><a href="#getlockstatus-object--null"><code>getLockStatus(): Object | null</code></a></li>
<li><a href="#setlockstatuslockstatus-object--null-void"><code>setLockStatus(lockStatus: Object | null): void</code></a></li>
<li><a href="#tojson-object"><code>toJSON(): Object</code></a></li>
<li><a href="#clone-collectionmetadata"><code>clone(): CollectionMetadata</code></a></li>
<li><a href="#static-methods">Static Methods</a></li>
<li><a href="#static-fromjsonobj-object-collectionmetadata"><code>static fromJSON(obj: Object): CollectionMetadata</code></a></li>
<li><a href="#static-createname-string-fileid-string-collectionmetadata"><code>static create(name: string, fileId: string): CollectionMetadata</code></a></li>
</ul>
</li>
<li><a href="#documentoperations">DocumentOperations</a><ul>
<li><a href="#purpose-2">Purpose</a></li>
<li><a href="#constructor-2">Constructor</a></li>
<li><a href="#public-methods-2">Public Methods</a></li>
<li><a href="#insertdocumentdoc-object-object">insertDocument(doc: Object): Object</a></li>
<li><a href="#finddocumentbyidid-string-objectnull">findDocumentById(id: string): Object|null</a></li>
<li><a href="#findalldocuments-arrayobject">findAllDocuments(): Array\&lt;Object&gt;</a></li>
<li><a href="#updatedocumentid-string-updatedata-object-object">updateDocument(id: string, updateData: Object): Object</a></li>
<li><a href="#deletedocumentid-string-object">deleteDocument(id: string): Object</a></li>
<li><a href="#countdocuments-number">countDocuments(): number</a></li>
<li><a href="#documentexistsid-string-boolean">documentExists(id: string): boolean</a></li>
<li><a href="#findbyqueryquery-object-objectnull">findByQuery(query: Object): Object|null</a></li>
<li><a href="#findmultiplebyqueryquery-object-arrayobject">findMultipleByQuery(query: Object): Array\&lt;Object&gt;</a></li>
<li><a href="#countbyqueryquery-object-number">countByQuery(query: Object): number</a></li>
<li><a href="#updatedocumentwithoperatorsid-string-updateops-object-object">updateDocumentWithOperators(id: string, updateOps: Object): Object</a></li>
<li><a href="#updatedocumentbyqueryquery-object-updateops-object-number">updateDocumentByQuery(query: Object, updateOps: Object): number</a></li>
<li><a href="#replacedocumentid-string-doc-object-object">replaceDocument(id: string, doc: Object): Object</a></li>
<li><a href="#replacedocumentbyqueryquery-object-doc-object-number">replaceDocumentByQuery(query: Object, doc: Object): number</a></li>
<li><a href="#private-methods">Private Methods</a></li>
</ul>
</li>
</ul>
<hr />
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>The Collection Components form the core of JsonDbApp's document storage system:</p>
<ul>
<li><strong>Collection</strong>: The main interface providing MongoDB-compatible CRUD operations</li>
<li><strong>CollectionMetadata</strong>: Manages collection metadata (timestamps, document counts)</li>
<li><strong>DocumentOperations</strong>: Handles low-level document manipulation</li>
</ul>
<h3 id="architecture">Architecture<a class="headerlink" href="#architecture" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>graph TD
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    Collection[Collection (High-level MongoDB API)] --&gt; CollectionMetadata[CollectionMetadata (Metadata management)]
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    Collection --&gt; DocumentOperations[DocumentOperations (Document CRUD operations)]
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    DocumentOperations --&gt; QueryEngine[QueryEngine (Query processing)]
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    DocumentOperations --&gt; UpdateEngine[UpdateEngine (Update operation processing)]
</code></pre></div>
<h3 id="current-limitations-section-5">Current Limitations (Section 5)<a class="headerlink" href="#current-limitations-section-5" title="Permanent link">&para;</a></h3>
<p>This section describes the capabilities as of Section 5. The <code>Collection</code> class has since been enhanced. Refer to the method descriptions below for current capabilities.</p>
<ul>
<li><strong>findOne()</strong>: Only supports <code>{}</code> (empty) and <code>{_id: "id"}</code> filters</li>
<li><strong>find()</strong>: Only supports <code>{}</code> (empty) filters</li>
<li><strong>updateOne()</strong>: Only supports <code>{_id: "id"}</code> filters, document replacement only (no operators)</li>
<li><strong>deleteOne()</strong>: Only supports <code>{_id: "id"}</code> filters</li>
<li><strong>countDocuments()</strong>: Only supports <code>{}</code> (empty) filters</li>
</ul>
<p>Advanced query capabilities will be added in Section 6 (Query Engine) and Section 7 (Update Engine).</p>
<hr />
<h2 id="collection">Collection<a class="headerlink" href="#collection" title="Permanent link">&para;</a></h2>
<h3 id="purpose">Purpose<a class="headerlink" href="#purpose" title="Permanent link">&para;</a></h3>
<p>Collection provides the primary interface for document operations, mimicking MongoDB's collection API whilst managing persistence to Google Drive.</p>
<p>Key responsibilities:</p>
<ul>
<li>MongoDB-compatible CRUD operations</li>
<li>Lazy loading from Google Drive</li>
<li>Dirty tracking and persistence</li>
<li>Integration with CollectionMetadata and DocumentOperations</li>
<li>Clear error messages for unsupported features</li>
</ul>
<h3 id="constructor">Constructor<a class="headerlink" href="#constructor" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="ow">new</span><span class="w"> </span><span class="nx">Collection</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">driveFileId</span><span class="p">,</span><span class="w"> </span><span class="nx">database</span><span class="p">,</span><span class="w"> </span><span class="nx">fileService</span><span class="p">);</span>
</code></pre></div>
<ul>
<li><strong>name</strong>: Collection name (non-empty string)</li>
<li><strong>driveFileId</strong>: Google Drive file ID for persistence</li>
<li><strong>database</strong>: Database instance reference</li>
<li><strong>fileService</strong>: FileService for Drive operations</li>
</ul>
<p><strong>Throws</strong>: <code>InvalidArgumentError</code> for invalid parameters</p>
<p><strong>Example:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="c1">// Typically created by Database class, not directly</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">collection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Collection</span><span class="p">(</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">  </span><span class="s1">&#39;users&#39;</span><span class="p">,</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">  </span><span class="s1">&#39;1a2b3c4d5e6f7g8h9i0j&#39;</span><span class="p">,</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">  </span><span class="nx">databaseInstance</span><span class="p">,</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="w">  </span><span class="nx">fileServiceInstance</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="p">);</span>
</code></pre></div>
<h3 id="public-methods">Public Methods<a class="headerlink" href="#public-methods" title="Permanent link">&para;</a></h3>
<h4 id="insertonedoc-object-object">insertOne(doc: Object): Object<a class="headerlink" href="#insertonedoc-object-object" title="Permanent link">&para;</a></h4>
<p>Insert a single document with automatic ID generation.</p>
<ul>
<li><strong>Parameters</strong></li>
<li><code>doc</code>: Document object to insert</li>
<li><strong>Returns</strong></li>
<li><code>{insertedId: string, acknowledged: boolean}</code></li>
<li><strong>Throws</strong></li>
<li><code>InvalidArgumentError</code> for invalid documents</li>
<li><code>ConflictError</code> for duplicate IDs</li>
</ul>
<p><strong>Example:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="c1">// Insert with auto-generated ID</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">result1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">collection</span><span class="p">.</span><span class="nx">insertOne</span><span class="p">({</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Alice&#39;</span><span class="p">,</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">  </span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;alice@example.com&#39;</span><span class="p">,</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">  </span><span class="nx">age</span><span class="o">:</span><span class="w"> </span><span class="mf">30</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="p">});</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Generated ID:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">result1</span><span class="p">.</span><span class="nx">insertedId</span><span class="p">);</span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="c1">// Insert with specific ID</span>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="kd">const</span><span class="w"> </span><span class="nx">result2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">collection</span><span class="p">.</span><span class="nx">insertOne</span><span class="p">({</span>
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="w">  </span><span class="nx">_id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;user123&#39;</span><span class="p">,</span>
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Bob&#39;</span><span class="p">,</span>
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a><span class="w">  </span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;bob@example.com&#39;</span>
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a><span class="p">});</span>
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Custom ID:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">result2</span><span class="p">.</span><span class="nx">insertedId</span><span class="p">);</span><span class="w"> </span><span class="c1">// &#39;user123&#39;</span>
<a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a>
<a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a><span class="c1">// Error: duplicate ID</span>
<a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a><span class="w">  </span><span class="nx">collection</span><span class="p">.</span><span class="nx">insertOne</span><span class="p">({</span><span class="w"> </span><span class="nx">_id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;user123&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Charlie&#39;</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Conflict:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
<a id="__codelineno-3-22" name="__codelineno-3-22" href="#__codelineno-3-22"></a><span class="p">}</span>
</code></pre></div>
<h4 id="findonefilter-object-objectnull">findOne(filter?: Object): Object|null<a class="headerlink" href="#findonefilter-object-objectnull" title="Permanent link">&para;</a></h4>
<p>Find a single document matching the filter.</p>
<ul>
<li><strong>Parameters</strong></li>
<li><code>filter</code>: Query filter (supports field-based queries, <code>{_id: "id"}</code> and empty <code>{}</code> filters)</li>
<li><strong>Returns</strong></li>
<li>Document object or <code>null</code> if not found</li>
<li><strong>Throws</strong></li>
<li><code>InvalidArgumentError</code> for invalid filter structure</li>
<li><code>OperationError</code> for unsupported filters</li>
</ul>
<p><strong>Example:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="c1">// Find first document (empty filter)</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">firstDoc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">collection</span><span class="p">.</span><span class="nx">findOne</span><span class="p">({});</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;First document:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">firstDoc</span><span class="p">);</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="c1">// Find by ID</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="kd">const</span><span class="w"> </span><span class="nx">userDoc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">collection</span><span class="p">.</span><span class="nx">findOne</span><span class="p">({</span><span class="w"> </span><span class="nx">_id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;user123&#39;</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">userDoc</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Found user:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">userDoc</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;User not found&#39;</span><span class="p">);</span>
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="p">}</span>
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a><span class="c1">// Find by field</span>
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="kd">const</span><span class="w"> </span><span class="nx">aliceDoc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">collection</span><span class="p">.</span><span class="nx">findOne</span><span class="p">({</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Alice&#39;</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">aliceDoc</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Found Alice by name:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">aliceDoc</span><span class="p">.</span><span class="nx">email</span><span class="p">);</span>
<a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a><span class="p">}</span>
<a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a>
<a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a><span class="c1">// Unsupported filter (throws error)</span>
<a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a><span class="w">  </span><span class="nx">collection</span><span class="p">.</span><span class="nx">findOne</span><span class="p">({</span><span class="w"> </span><span class="nx">age</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">$gt</span><span class="o">:</span><span class="w"> </span><span class="mf">25</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">});</span><span class="w"> </span><span class="c1">// Complex operators may not be supported depending on QueryEngine</span>
<a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Unsupported:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
<a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a><span class="p">}</span>
</code></pre></div>
<h4 id="findfilter-object-array">find(filter?: Object): Array<a class="headerlink" href="#findfilter-object-array" title="Permanent link">&para;</a></h4>
<p>Find multiple documents matching the filter.</p>
<ul>
<li><strong>Parameters</strong></li>
<li><code>filter</code>: Query filter (supports field-based queries and empty <code>{}</code> filter)</li>
<li><strong>Returns</strong></li>
<li>Array of document objects</li>
<li><strong>Throws</strong></li>
<li><code>InvalidArgumentError</code> for invalid filter structure</li>
<li><code>OperationError</code> for unsupported filters</li>
</ul>
<p><strong>Example:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="c1">// Find all documents</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">allDocs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">collection</span><span class="p">.</span><span class="nx">find</span><span class="p">({});</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Total documents:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">allDocs</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="nx">allDocs</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">doc</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Document ID:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">doc</span><span class="p">.</span><span class="nx">_id</span><span class="p">);</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="p">});</span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="c1">// Find by field</span>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="kd">const</span><span class="w"> </span><span class="nx">usersOver25</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">collection</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="w"> </span><span class="nx">age</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">$gt</span><span class="o">:</span><span class="w"> </span><span class="mf">25</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">});</span><span class="w"> </span><span class="c1">// Example, assuming QueryEngine supports $gt</span>
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Users over 25:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">usersOver25</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a>
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="c1">// Empty collection returns empty array</span>
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a><span class="kd">const</span><span class="w"> </span><span class="nx">emptyResults</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">emptyCollection</span><span class="p">.</span><span class="nx">find</span><span class="p">({});</span>
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Empty results:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">emptyResults</span><span class="p">);</span><span class="w"> </span><span class="c1">// []</span>
</code></pre></div>
<h4 id="updateonefilter-object-update-object-object">updateOne(filter: Object, update: Object): Object<a class="headerlink" href="#updateonefilter-object-update-object-object" title="Permanent link">&para;</a></h4>
<p>Update a single document matching the filter.</p>
<ul>
<li><strong>Parameters</strong></li>
<li><code>filter</code>: Query filter (supports field-based queries and <code>{_id: "id"}</code> filters)</li>
<li><code>update</code>: Document replacement or update operators (e.g. <code>{$set: {field: value}}</code>)</li>
<li><strong>Returns</strong></li>
<li><code>{matchedCount: number, modifiedCount: number, acknowledged: boolean}</code></li>
<li><strong>Throws</strong></li>
<li><code>InvalidArgumentError</code> for invalid parameters (filter or update)</li>
<li><code>OperationError</code> for unsupported filters or update operators</li>
</ul>
<p><strong>Example:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="c1">// Update by ID (document replacement)</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">updateResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">collection</span><span class="p">.</span><span class="nx">updateOne</span><span class="p">(</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nx">_id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;user123&#39;</span><span class="w"> </span><span class="p">},</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="w">  </span><span class="p">{</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="w">    </span><span class="c1">// _id: &#39;user123&#39;, // ID is preserved automatically if not specified in replacement</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Robert&#39;</span><span class="p">,</span>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="w">    </span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;robert@example.com&#39;</span><span class="p">,</span>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="w">    </span><span class="nx">age</span><span class="o">:</span><span class="w"> </span><span class="mf">31</span><span class="p">,</span>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="w">    </span><span class="nx">lastUpdated</span><span class="o">:</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">()</span>
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="p">);</span>
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Modified count (replacement):&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">updateResult</span><span class="p">.</span><span class="nx">modifiedCount</span><span class="p">);</span><span class="w"> </span><span class="c1">// 1</span>
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a>
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a><span class="c1">// Update by field using $set operator</span>
<a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a><span class="kd">const</span><span class="w"> </span><span class="nx">setResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">collection</span><span class="p">.</span><span class="nx">updateOne</span><span class="p">({</span><span class="w"> </span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;robert@example.com&#39;</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">$set</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">age</span><span class="o">:</span><span class="w"> </span><span class="mf">32</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Modified count ($set):&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">setResult</span><span class="p">.</span><span class="nx">modifiedCount</span><span class="p">);</span><span class="w"> </span><span class="c1">// 1</span>
<a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a>
<a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a><span class="c1">// Non-existent document</span>
<a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a><span class="kd">const</span><span class="w"> </span><span class="nx">noMatch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">collection</span><span class="p">.</span><span class="nx">updateOne</span><span class="p">({</span><span class="w"> </span><span class="nx">_id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;nonexistent&#39;</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Nobody&#39;</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;No match:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">noMatch</span><span class="p">.</span><span class="nx">modifiedCount</span><span class="p">);</span><span class="w"> </span><span class="c1">// 0</span>
<a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a>
<a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a><span class="c1">// Unsupported update operators (throws error)</span>
<a id="__codelineno-6-24" name="__codelineno-6-24" href="#__codelineno-6-24"></a><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-25" name="__codelineno-6-25" href="#__codelineno-6-25"></a><span class="w">  </span><span class="nx">collection</span><span class="p">.</span><span class="nx">updateOne</span><span class="p">(</span>
<a id="__codelineno-6-26" name="__codelineno-6-26" href="#__codelineno-6-26"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">_id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;user123&#39;</span><span class="w"> </span><span class="p">},</span>
<a id="__codelineno-6-27" name="__codelineno-6-27" href="#__codelineno-6-27"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">$inc</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">age</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="c1">// Assuming $inc is supported by UpdateEngine</span>
<a id="__codelineno-6-28" name="__codelineno-6-28" href="#__codelineno-6-28"></a><span class="w">  </span><span class="p">);</span>
<a id="__codelineno-6-29" name="__codelineno-6-29" href="#__codelineno-6-29"></a><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-30" name="__codelineno-6-30" href="#__codelineno-6-30"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Unsupported operator or error during update:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
<a id="__codelineno-6-31" name="__codelineno-6-31" href="#__codelineno-6-31"></a><span class="p">}</span>
</code></pre></div>
<h4 id="updatemanyfilter-object-update-object-object">updateMany(filter: Object, update: Object): Object<a class="headerlink" href="#updatemanyfilter-object-update-object-object" title="Permanent link">&para;</a></h4>
<p>Update multiple documents matching a filter.</p>
<ul>
<li><strong>Parameters</strong></li>
<li><code>filter</code>: Query filter criteria (supports field-based queries and empty <code>{}</code> filter)</li>
<li><code>update</code>: Update operators (e.g. <code>{$set: {field: value}}</code>)</li>
<li><strong>Returns</strong></li>
<li><code>{matchedCount: number, modifiedCount: number, acknowledged: boolean}</code></li>
<li><strong>Throws</strong></li>
<li><code>InvalidArgumentError</code> for invalid parameters</li>
<li><code>OperationError</code> if update operators are invalid or an error occurs</li>
</ul>
<p><strong>Example:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="c1">// Add a &#39;status&#39; field to all documents</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">updateManyResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">collection</span><span class="p">.</span><span class="nx">updateMany</span><span class="p">(</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">  </span><span class="p">{},</span><span class="w"> </span><span class="c1">// Empty filter matches all documents</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nx">$set</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;active&#39;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="p">);</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Matched:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">updateManyResult</span><span class="p">.</span><span class="nx">matchedCount</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Modified:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">updateManyResult</span><span class="p">.</span><span class="nx">modifiedCount</span><span class="p">);</span>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="c1">// Update status for users older than 30</span>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="kd">const</span><span class="w"> </span><span class="nx">updateAdultsResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">collection</span><span class="p">.</span><span class="nx">updateMany</span><span class="p">(</span>
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nx">age</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">$gt</span><span class="o">:</span><span class="w"> </span><span class="mf">30</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="c1">// Assuming QueryEngine supports $gt</span>
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nx">$set</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;senior&#39;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a><span class="p">);</span>
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Adults updated:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">updateAdultsResult</span><span class="p">.</span><span class="nx">modifiedCount</span><span class="p">);</span>
</code></pre></div>
<h4 id="replaceonefilter-object-replacement-object-object">replaceOne(filter: Object, replacement: Object): Object<a class="headerlink" href="#replaceonefilter-object-replacement-object-object" title="Permanent link">&para;</a></h4>
<p>Replace a single document matching the filter.</p>
<ul>
<li><strong>Parameters</strong></li>
<li><code>filter</code>: Query filter (supports field-based queries and <code>{_id: "id"}</code> filters)</li>
<li><code>replacement</code>: The new document. Cannot contain update operators. <code>_id</code> if present must match original or be omitted.</li>
<li><strong>Returns</strong></li>
<li><code>{matchedCount: number, modifiedCount: number, acknowledged: boolean}</code></li>
<li><strong>Throws</strong></li>
<li><code>InvalidArgumentError</code> for invalid parameters or if replacement contains update operators.</li>
</ul>
<p><strong>Example:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="c1">// Replace document by ID</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">replaceResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">collection</span><span class="p">.</span><span class="nx">replaceOne</span><span class="p">(</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nx">_id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;user123&#39;</span><span class="w"> </span><span class="p">},</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Bobby Tables&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;bobby@example.com&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">age</span><span class="o">:</span><span class="w"> </span><span class="mf">25</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="c1">// _id will be preserved</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="p">);</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Replaced count:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">replaceResult</span><span class="p">.</span><span class="nx">modifiedCount</span><span class="p">);</span><span class="w"> </span><span class="c1">// 1</span>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="c1">// Attempt to replace with update operators (will throw error)</span>
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="w">  </span><span class="nx">collection</span><span class="p">.</span><span class="nx">replaceOne</span><span class="p">({</span><span class="w"> </span><span class="nx">_id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;user123&#39;</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">$set</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Not Allowed&#39;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Error:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span><span class="w"> </span><span class="c1">// Should indicate $set is not allowed</span>
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a><span class="p">}</span>
</code></pre></div>
<h4 id="deleteonefilter-object-object">deleteOne(filter: Object): Object<a class="headerlink" href="#deleteonefilter-object-object" title="Permanent link">&para;</a></h4>
<p>Delete a single document matching the filter.</p>
<ul>
<li><strong>Parameters</strong></li>
<li><code>filter</code>: Query filter (supports field-based queries and <code>{_id: "id"}</code> filters)</li>
<li><strong>Returns</strong></li>
</ul>
<p><code>{deletedCount: number, acknowledged: boolean}</code></p>
<ul>
<li><strong>Throws</strong></li>
<li><code>InvalidArgumentError</code> for invalid filter structure</li>
<li><code>OperationError</code> for unsupported filters</li>
</ul>
<p><strong>Example:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="c1">// Delete by ID</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">deleteResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">collection</span><span class="p">.</span><span class="nx">deleteOne</span><span class="p">({</span><span class="w"> </span><span class="nx">_id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;user123&#39;</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Deleted count by ID:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">deleteResult</span><span class="p">.</span><span class="nx">deletedCount</span><span class="p">);</span><span class="w"> </span><span class="c1">// 1</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="c1">// Delete by field</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="kd">const</span><span class="w"> </span><span class="nx">deleteByEmailResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">collection</span><span class="p">.</span><span class="nx">deleteOne</span><span class="p">({</span><span class="w"> </span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;alice@example.com&#39;</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Deleted count by email:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">deleteByEmailResult</span><span class="p">.</span><span class="nx">deletedCount</span><span class="p">);</span><span class="w"> </span><span class="c1">// 1</span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="c1">// Non-existent document</span>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="kd">const</span><span class="w"> </span><span class="nx">noDelete</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">collection</span><span class="p">.</span><span class="nx">deleteOne</span><span class="p">({</span><span class="w"> </span><span class="nx">_id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;nonexistent&#39;</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Nothing deleted:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">noDelete</span><span class="p">.</span><span class="nx">deletedCount</span><span class="p">);</span><span class="w"> </span><span class="c1">// 0</span>
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a><span class="c1">// Document no longer exists</span>
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a><span class="kd">const</span><span class="w"> </span><span class="nx">gone</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">collection</span><span class="p">.</span><span class="nx">findOne</span><span class="p">({</span><span class="w"> </span><span class="nx">_id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;user123&#39;</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Document gone:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">gone</span><span class="p">);</span><span class="w"> </span><span class="c1">// null</span>
</code></pre></div>
<h4 id="countdocumentsfilter-object-number">countDocuments(filter?: Object): number<a class="headerlink" href="#countdocumentsfilter-object-number" title="Permanent link">&para;</a></h4>
<p>Count documents matching the filter.</p>
<ul>
<li><strong>Parameters</strong></li>
<li><code>filter</code>: Query filter (supports field-based queries and empty <code>{}</code> filter)</li>
<li><strong>Returns</strong></li>
</ul>
<p>Number of matching documents</p>
<ul>
<li><strong>Throws</strong></li>
<li><code>InvalidArgumentError</code> for invalid filter structure</li>
<li><code>OperationError</code> for unsupported filters</li>
</ul>
<p><strong>Example:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="c1">// Count all documents</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">totalCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">collection</span><span class="p">.</span><span class="nx">countDocuments</span><span class="p">({});</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Total documents:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">totalCount</span><span class="p">);</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="c1">// Count documents matching a filter</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="kd">const</span><span class="w"> </span><span class="nx">countOver30</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">collection</span><span class="p">.</span><span class="nx">countDocuments</span><span class="p">({</span><span class="w"> </span><span class="nx">age</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">$gt</span><span class="o">:</span><span class="w"> </span><span class="mf">30</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">});</span><span class="w"> </span><span class="c1">// Assuming QueryEngine supports $gt</span>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Documents with age &gt; 30:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">countOver30</span><span class="p">);</span>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="c1">// Empty collection</span>
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="kd">const</span><span class="w"> </span><span class="nx">emptyCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">emptyCollection</span><span class="p">.</span><span class="nx">countDocuments</span><span class="p">();</span>
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Empty count:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">emptyCount</span><span class="p">);</span><span class="w"> </span><span class="c1">// 0</span>
<a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a>
<a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a><span class="c1">// Verify count matches find() results</span>
<a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a><span class="kd">const</span><span class="w"> </span><span class="nx">allDocs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">collection</span><span class="p">.</span><span class="nx">find</span><span class="p">({});</span>
<a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Count matches:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">totalCount</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">allDocs</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span><span class="w"> </span><span class="c1">// true</span>
</code></pre></div>
<h4 id="getname-string">getName(): string<a class="headerlink" href="#getname-string" title="Permanent link">&para;</a></h4>
<p>Get the collection name.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">collection</span><span class="p">.</span><span class="nx">getName</span><span class="p">();</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Collection name:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="p">);</span><span class="w"> </span><span class="c1">// &#39;users&#39;</span>
</code></pre></div>
<h4 id="getmetadata-object">getMetadata(): Object<a class="headerlink" href="#getmetadata-object" title="Permanent link">&para;</a></h4>
<p>Get collection metadata.</p>
<ul>
<li><strong>Returns</strong></li>
<li><code>{created: Date, lastUpdated: Date, documentCount: number}</code></li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">metadata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">collection</span><span class="p">.</span><span class="nx">getMetadata</span><span class="p">();</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Created:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">metadata</span><span class="p">.</span><span class="nx">created</span><span class="p">);</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Last updated:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">metadata</span><span class="p">.</span><span class="nx">lastUpdated</span><span class="p">);</span>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Document count:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">metadata</span><span class="p">.</span><span class="nx">documentCount</span><span class="p">);</span>
</code></pre></div>
<h4 id="isdirty-boolean">isDirty(): boolean<a class="headerlink" href="#isdirty-boolean" title="Permanent link">&para;</a></h4>
<p>Check if collection has unsaved changes.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Has changes:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">collection</span><span class="p">.</span><span class="nx">isDirty</span><span class="p">());</span><span class="w"> </span><span class="c1">// false</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="nx">collection</span><span class="p">.</span><span class="nx">insertOne</span><span class="p">({</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Test&#39;</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Has changes:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">collection</span><span class="p">.</span><span class="nx">isDirty</span><span class="p">());</span><span class="w"> </span><span class="c1">// true</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="nx">collection</span><span class="p">.</span><span class="nx">save</span><span class="p">();</span>
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Has changes:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">collection</span><span class="p">.</span><span class="nx">isDirty</span><span class="p">());</span><span class="w"> </span><span class="c1">// false</span>
</code></pre></div>
<h4 id="save-void">save(): void<a class="headerlink" href="#save-void" title="Permanent link">&para;</a></h4>
<p>Force save collection to Drive.</p>
<ul>
<li><strong>Throws</strong>: <code>OperationError</code> if save fails</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="c1">// Manual save (usually automatic)</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="w">  </span><span class="nx">collection</span><span class="p">.</span><span class="nx">save</span><span class="p">();</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Collection saved&#39;</span><span class="p">);</span>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Save failed:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="p">}</span>
</code></pre></div>
<h3 id="lazy-loading">Lazy Loading<a class="headerlink" href="#lazy-loading" title="Permanent link">&para;</a></h3>
<p>Collections use lazy loading for performance:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">collection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Collection</span><span class="p">(...);</span><span class="w"> </span><span class="c1">// No Drive access yet</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="kd">const</span><span class="w"> </span><span class="nx">metadata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">collection</span><span class="p">.</span><span class="nx">getMetadata</span><span class="p">();</span><span class="w"> </span><span class="c1">// Triggers loading</span>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="kd">const</span><span class="w"> </span><span class="nx">docs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">collection</span><span class="p">.</span><span class="nx">find</span><span class="p">({});</span><span class="w"> </span><span class="c1">// Already loaded, no Drive access</span>
</code></pre></div>
<hr />
<h2 id="collectionmetadata">CollectionMetadata<a class="headerlink" href="#collectionmetadata" title="Permanent link">&para;</a></h2>
<h3 id="purpose_1">Purpose<a class="headerlink" href="#purpose_1" title="Permanent link">&para;</a></h3>
<p><code>CollectionMetadata</code> manages essential information about a collection. This includes its identity (name and file ID), timestamps for creation and updates, the number of documents it contains, a token for managing concurrent modifications, and its current lock status. It ensures that metadata is always in a valid state and provides methods for its manipulation and serialisation.</p>
<h3 id="constructor_1">Constructor<a class="headerlink" href="#constructor_1" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="ow">new</span><span class="w"> </span><span class="nx">CollectionMetadata</span><span class="p">(</span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="nx">string</span><span class="p">,</span><span class="w"> </span><span class="nx">fileId</span><span class="o">:</span><span class="w"> </span><span class="nx">string</span><span class="p">,</span><span class="w"> </span><span class="nx">initialMetadata</span><span class="o">?:</span><span class="w"> </span><span class="nb">Object</span><span class="p">)</span>
</code></pre></div>
<p>or (legacy support)</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="ow">new</span><span class="w"> </span><span class="nx">CollectionMetadata</span><span class="p">(</span><span class="nx">initialMetadata</span><span class="o">:</span><span class="w"> </span><span class="nb">Object</span><span class="p">)</span>
</code></pre></div>
<ul>
<li><strong>name</strong> (string): The name of the collection. This is a required field.</li>
<li><strong>fileId</strong> (string): The Google Drive file ID where the collection data is stored. This is a required field.</li>
<li><strong>initialMetadata</strong> (optional Object): An object containing initial values for metadata properties.</li>
<li><code>created</code>: Creation timestamp (Date). Defaults to the current time.</li>
<li><code>lastUpdated</code>: Last update timestamp (Date). Defaults to the current time.</li>
<li><code>documentCount</code>: Document count (integer  0). Defaults to 0.</li>
<li><code>modificationToken</code>: A string token for optimistic locking, or <code>null</code>. Defaults to <code>null</code>.</li>
<li><code>lockStatus</code>: An object detailing the lock state, or <code>null</code>. Defaults to <code>null</code>.<ul>
<li><code>isLocked</code>: (boolean) Whether the collection is locked.</li>
<li><code>lockedBy</code>: (string|null) Identifier of the process/user holding the lock.</li>
<li><code>lockedAt</code>: (number|null) Timestamp (epoch milliseconds) when the lock was acquired.</li>
<li><code>lockTimeout</code>: (number|null) Duration in milliseconds for which the lock is valid.</li>
</ul>
</li>
</ul>
<p><strong>Throws</strong>: <code>InvalidArgumentError</code> for invalid or missing <code>name</code>, <code>fileId</code>, or other metadata values.</p>
<p><strong>Example:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="c1">// Create with name, fileId, and defaults for other properties</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">metadata1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">CollectionMetadata</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;fileId123&#39;</span><span class="p">);</span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Collection Name:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">metadata1</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span><span class="w"> </span><span class="c1">// &#39;users&#39;</span>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;File ID:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">metadata1</span><span class="p">.</span><span class="nx">fileId</span><span class="p">);</span><span class="w"> </span><span class="c1">// &#39;fileId123&#39;</span>
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Default count:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">metadata1</span><span class="p">.</span><span class="nx">documentCount</span><span class="p">);</span><span class="w"> </span><span class="c1">// 0</span>
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a>
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="c1">// Create with name, fileId, and specific initial values</span>
<a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="kd">const</span><span class="w"> </span><span class="nx">metadata2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">CollectionMetadata</span><span class="p">(</span><span class="s1">&#39;products&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;fileId456&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a><span class="w">  </span><span class="nx">created</span><span class="o">:</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2023-01-01&#39;</span><span class="p">),</span>
<a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a><span class="w">  </span><span class="nx">lastUpdated</span><span class="o">:</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2023-06-15&#39;</span><span class="p">),</span>
<a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a><span class="w">  </span><span class="nx">documentCount</span><span class="o">:</span><span class="w"> </span><span class="mf">42</span><span class="p">,</span>
<a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a><span class="w">  </span><span class="nx">modificationToken</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;initialToken123&#39;</span><span class="p">,</span>
<a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a><span class="w">  </span><span class="nx">lockStatus</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">isLocked</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="nx">lockedBy</span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="nx">lockedAt</span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="nx">lockTimeout</span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a><span class="p">});</span>
<a id="__codelineno-18-15" name="__codelineno-18-15" href="#__codelineno-18-15"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Product count:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">metadata2</span><span class="p">.</span><span class="nx">documentCount</span><span class="p">);</span><span class="w"> </span><span class="c1">// 42</span>
<a id="__codelineno-18-16" name="__codelineno-18-16" href="#__codelineno-18-16"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Modification Token:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">metadata2</span><span class="p">.</span><span class="nx">getModificationToken</span><span class="p">());</span><span class="w"> </span><span class="c1">// &#39;initialToken123&#39;</span>
<a id="__codelineno-18-17" name="__codelineno-18-17" href="#__codelineno-18-17"></a>
<a id="__codelineno-18-18" name="__codelineno-18-18" href="#__codelineno-18-18"></a><span class="c1">// Invalid values throw errors</span>
<a id="__codelineno-18-19" name="__codelineno-18-19" href="#__codelineno-18-19"></a><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-20" name="__codelineno-18-20" href="#__codelineno-18-20"></a><span class="w">  </span><span class="ow">new</span><span class="w"> </span><span class="nx">CollectionMetadata</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;fileId789&#39;</span><span class="p">);</span><span class="w"> </span><span class="c1">// Empty name</span>
<a id="__codelineno-18-21" name="__codelineno-18-21" href="#__codelineno-18-21"></a><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-22" name="__codelineno-18-22" href="#__codelineno-18-22"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Invalid name:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
<a id="__codelineno-18-23" name="__codelineno-18-23" href="#__codelineno-18-23"></a><span class="p">}</span>
<a id="__codelineno-18-24" name="__codelineno-18-24" href="#__codelineno-18-24"></a>
<a id="__codelineno-18-25" name="__codelineno-18-25" href="#__codelineno-18-25"></a><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-26" name="__codelineno-18-26" href="#__codelineno-18-26"></a><span class="w">  </span><span class="ow">new</span><span class="w"> </span><span class="nx">CollectionMetadata</span><span class="p">(</span><span class="s1">&#39;orders&#39;</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span><span class="w"> </span><span class="c1">// Missing fileId</span>
<a id="__codelineno-18-27" name="__codelineno-18-27" href="#__codelineno-18-27"></a><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-28" name="__codelineno-18-28" href="#__codelineno-18-28"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Invalid fileId:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
<a id="__codelineno-18-29" name="__codelineno-18-29" href="#__codelineno-18-29"></a><span class="p">}</span>
<a id="__codelineno-18-30" name="__codelineno-18-30" href="#__codelineno-18-30"></a>
<a id="__codelineno-18-31" name="__codelineno-18-31" href="#__codelineno-18-31"></a><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-32" name="__codelineno-18-32" href="#__codelineno-18-32"></a><span class="w">  </span><span class="ow">new</span><span class="w"> </span><span class="nx">CollectionMetadata</span><span class="p">(</span><span class="s1">&#39;inventory&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;fileIdABC&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">documentCount</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="mf">1</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-18-33" name="__codelineno-18-33" href="#__codelineno-18-33"></a><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-34" name="__codelineno-18-34" href="#__codelineno-18-34"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Invalid count:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
<a id="__codelineno-18-35" name="__codelineno-18-35" href="#__codelineno-18-35"></a><span class="p">}</span>
</code></pre></div>
<h3 id="public-methods_1">Public Methods<a class="headerlink" href="#public-methods_1" title="Permanent link">&para;</a></h3>
<h4 id="updatelastmodified-void"><code>updateLastModified(): void</code><a class="headerlink" href="#updatelastmodified-void" title="Permanent link">&para;</a></h4>
<p>Updates the <code>lastUpdated</code> timestamp to the current time.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">metadata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">CollectionMetadata</span><span class="p">(</span><span class="s1">&#39;logs&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;logFileId&#39;</span><span class="p">);</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">oldTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">metadata</span><span class="p">.</span><span class="nx">lastUpdated</span><span class="p">;</span>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="c1">// Wait a moment...</span>
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="nx">setTimeout</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="w">  </span><span class="nx">metadata</span><span class="p">.</span><span class="nx">updateLastModified</span><span class="p">();</span>
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Updated:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">metadata</span><span class="p">.</span><span class="nx">lastUpdated</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">oldTime</span><span class="p">);</span><span class="w"> </span><span class="c1">// true</span>
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a><span class="p">},</span><span class="w"> </span><span class="mf">10</span><span class="p">);</span>
</code></pre></div>
<h4 id="touch-void"><code>touch(): void</code><a class="headerlink" href="#touch-void" title="Permanent link">&para;</a></h4>
<p>Alias for <code>updateLastModified()</code>. Updates the <code>lastUpdated</code> timestamp to the current time. This is typically used to signify that the collection metadata has been accessed or "touched" without necessarily changing other data like document count.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">metadata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">CollectionMetadata</span><span class="p">(</span><span class="s1">&#39;cache&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;cacheFileId&#39;</span><span class="p">);</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">oldTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">metadata</span><span class="p">.</span><span class="nx">lastUpdated</span><span class="p">;</span>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="nx">metadata</span><span class="p">.</span><span class="nx">touch</span><span class="p">();</span>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Touched, lastUpdated changed:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">metadata</span><span class="p">.</span><span class="nx">lastUpdated</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">oldTime</span><span class="p">);</span><span class="w"> </span><span class="c1">// true (assuming a slight delay)</span>
</code></pre></div>
<h4 id="incrementdocumentcount-void"><code>incrementDocumentCount(): void</code><a class="headerlink" href="#incrementdocumentcount-void" title="Permanent link">&para;</a></h4>
<p>Increments the <code>documentCount</code> by 1 and updates the <code>lastUpdated</code> timestamp.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">metadata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">CollectionMetadata</span><span class="p">(</span><span class="s1">&#39;tasks&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;tasksFileId&#39;</span><span class="p">);</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Initial count:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">metadata</span><span class="p">.</span><span class="nx">documentCount</span><span class="p">);</span><span class="w"> </span><span class="c1">// 0</span>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="nx">metadata</span><span class="p">.</span><span class="nx">incrementDocumentCount</span><span class="p">();</span>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;After increment:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">metadata</span><span class="p">.</span><span class="nx">documentCount</span><span class="p">);</span><span class="w"> </span><span class="c1">// 1</span>
</code></pre></div>
<h4 id="decrementdocumentcount-void"><code>decrementDocumentCount(): void</code><a class="headerlink" href="#decrementdocumentcount-void" title="Permanent link">&para;</a></h4>
<p>Decrements the <code>documentCount</code> by 1 and updates the <code>lastUpdated</code> timestamp.</p>
<ul>
<li><strong>Throws</strong>: <code>InvalidArgumentError</code> if <code>documentCount</code> would go below zero.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">metadata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">CollectionMetadata</span><span class="p">(</span><span class="s1">&#39;items&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;itemsFileId&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">documentCount</span><span class="o">:</span><span class="w"> </span><span class="mf">5</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="nx">metadata</span><span class="p">.</span><span class="nx">decrementDocumentCount</span><span class="p">();</span>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;After decrement:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">metadata</span><span class="p">.</span><span class="nx">documentCount</span><span class="p">);</span><span class="w"> </span><span class="c1">// 4</span>
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a>
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="c1">// Cannot go below zero</span>
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">emptyMetadata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">CollectionMetadata</span><span class="p">(</span><span class="s1">&#39;empty&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;emptyFileId&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">documentCount</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a><span class="w">  </span><span class="nx">emptyMetadata</span><span class="p">.</span><span class="nx">decrementDocumentCount</span><span class="p">();</span><span class="w"> </span><span class="c1">// Throws error</span>
<a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Cannot decrement:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
<a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a><span class="p">}</span>
</code></pre></div>
<h4 id="setdocumentcountcount-number-void"><code>setDocumentCount(count: number): void</code><a class="headerlink" href="#setdocumentcountcount-number-void" title="Permanent link">&para;</a></h4>
<p>Sets the <code>documentCount</code> to a specific value and updates the <code>lastUpdated</code> timestamp.</p>
<ul>
<li><strong>Parameters</strong>:</li>
<li><code>count</code>: The new document count (must be an integer  0).</li>
<li><strong>Throws</strong>: <code>InvalidArgumentError</code> for invalid <code>count</code> values (e.g., negative, not an integer).</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">metadata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">CollectionMetadata</span><span class="p">(</span><span class="s1">&#39;notes&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;notesFileId&#39;</span><span class="p">);</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="nx">metadata</span><span class="p">.</span><span class="nx">setDocumentCount</span><span class="p">(</span><span class="mf">100</span><span class="p">);</span>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Set count:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">metadata</span><span class="p">.</span><span class="nx">documentCount</span><span class="p">);</span><span class="w"> </span><span class="c1">// 100</span>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a>
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="c1">// Invalid values throw errors</span>
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a><span class="w">  </span><span class="nx">metadata</span><span class="p">.</span><span class="nx">setDocumentCount</span><span class="p">(</span><span class="o">-</span><span class="mf">5</span><span class="p">);</span><span class="w"> </span><span class="c1">// Throws error</span>
<a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Invalid count for setDocumentCount:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
<a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a><span class="p">}</span>
</code></pre></div>
<h4 id="getmodificationtoken-string-null"><code>getModificationToken(): string | null</code><a class="headerlink" href="#getmodificationtoken-string-null" title="Permanent link">&para;</a></h4>
<p>Returns the current <code>modificationToken</code>. This token can be used for optimistic concurrency control.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">metadata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">CollectionMetadata</span><span class="p">(</span><span class="s1">&#39;configs&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;configsFileId&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">modificationToken</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;v1&#39;</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">metadata</span><span class="p">.</span><span class="nx">getModificationToken</span><span class="p">());</span><span class="w"> </span><span class="c1">// &#39;v1&#39;</span>
</code></pre></div>
<h4 id="setmodificationtokentoken-string-null-void"><code>setModificationToken(token: string | null): void</code><a class="headerlink" href="#setmodificationtokentoken-string-null-void" title="Permanent link">&para;</a></h4>
<p>Sets the <code>modificationToken</code>.</p>
<ul>
<li><strong>Parameters</strong>:</li>
<li><code>token</code>: The new modification token (string or <code>null</code>). Must be a non-empty string if not <code>null</code>.</li>
<li><strong>Throws</strong>: <code>InvalidArgumentError</code> for invalid token values.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">metadata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">CollectionMetadata</span><span class="p">(</span><span class="s1">&#39;settings&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;settingsFileId&#39;</span><span class="p">);</span>
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="nx">metadata</span><span class="p">.</span><span class="nx">setModificationToken</span><span class="p">(</span><span class="s1">&#39;v2-alpha&#39;</span><span class="p">);</span>
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">metadata</span><span class="p">.</span><span class="nx">getModificationToken</span><span class="p">());</span><span class="w"> </span><span class="c1">// &#39;v2-alpha&#39;</span>
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a>
<a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="nx">metadata</span><span class="p">.</span><span class="nx">setModificationToken</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
<a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">metadata</span><span class="p">.</span><span class="nx">getModificationToken</span><span class="p">());</span><span class="w"> </span><span class="c1">// null</span>
<a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a>
<a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a><span class="w">  </span><span class="nx">metadata</span><span class="p">.</span><span class="nx">setModificationToken</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span><span class="w"> </span><span class="c1">// Empty string</span>
<a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Invalid token:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
<a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a><span class="p">}</span>
</code></pre></div>
<h4 id="getlockstatus-object-null"><code>getLockStatus(): Object | null</code><a class="headerlink" href="#getlockstatus-object-null" title="Permanent link">&para;</a></h4>
<p>Returns the current <code>lockStatus</code> object or <code>null</code> if no lock information is set.
The <code>lockStatus</code> object has the shape: <code>{ isLocked: boolean, lockedBy: string|null, lockedAt: number|null, lockTimeout: number|null }</code>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">lockInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="w">  </span><span class="nx">isLocked</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="w">  </span><span class="nx">lockedBy</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;process-1&#39;</span><span class="p">,</span>
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a><span class="w">  </span><span class="nx">lockedAt</span><span class="o">:</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">(),</span>
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a><span class="w">  </span><span class="nx">lockTimeout</span><span class="o">:</span><span class="w"> </span><span class="mf">30000</span>
<a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a><span class="p">};</span>
<a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a><span class="kd">const</span><span class="w"> </span><span class="nx">metadata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">CollectionMetadata</span><span class="p">(</span><span class="s1">&#39;jobs&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;jobsFileId&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">lockStatus</span><span class="o">:</span><span class="w"> </span><span class="nx">lockInfo</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">metadata</span><span class="p">.</span><span class="nx">getLockStatus</span><span class="p">());</span><span class="w"> </span><span class="c1">// { isLocked: true, ... }</span>
</code></pre></div>
<h4 id="setlockstatuslockstatus-object-null-void"><code>setLockStatus(lockStatus: Object | null): void</code><a class="headerlink" href="#setlockstatuslockstatus-object-null-void" title="Permanent link">&para;</a></h4>
<p>Sets the <code>lockStatus</code>.</p>
<ul>
<li><strong>Parameters</strong>:</li>
<li><code>lockStatus</code>: The new lock status object or <code>null</code>. If an object, it must conform to the required structure and types.</li>
<li><strong>Throws</strong>: <code>InvalidArgumentError</code> for invalid <code>lockStatus</code> object structure or values.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">metadata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">CollectionMetadata</span><span class="p">(</span><span class="s1">&#39;queue&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;queueFileId&#39;</span><span class="p">);</span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">newLock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="w">  </span><span class="nx">isLocked</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="w">  </span><span class="nx">lockedBy</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;worker-bee&#39;</span><span class="p">,</span>
<a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a><span class="w">  </span><span class="nx">lockedAt</span><span class="o">:</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">(),</span>
<a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a><span class="w">  </span><span class="nx">lockTimeout</span><span class="o">:</span><span class="w"> </span><span class="mf">60000</span>
<a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a><span class="p">};</span>
<a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a><span class="nx">metadata</span><span class="p">.</span><span class="nx">setLockStatus</span><span class="p">(</span><span class="nx">newLock</span><span class="p">);</span>
<a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">metadata</span><span class="p">.</span><span class="nx">getLockStatus</span><span class="p">());</span><span class="w"> </span><span class="c1">// { isLocked: true, lockedBy: &#39;worker-bee&#39;, ... }</span>
<a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a>
<a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a><span class="nx">metadata</span><span class="p">.</span><span class="nx">setLockStatus</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
<a id="__codelineno-27-12" name="__codelineno-27-12" href="#__codelineno-27-12"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">metadata</span><span class="p">.</span><span class="nx">getLockStatus</span><span class="p">());</span><span class="w"> </span><span class="c1">// null</span>
<a id="__codelineno-27-13" name="__codelineno-27-13" href="#__codelineno-27-13"></a>
<a id="__codelineno-27-14" name="__codelineno-27-14" href="#__codelineno-27-14"></a><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-27-15" name="__codelineno-27-15" href="#__codelineno-27-15"></a><span class="w">  </span><span class="nx">metadata</span><span class="p">.</span><span class="nx">setLockStatus</span><span class="p">({</span><span class="w"> </span><span class="nx">isLocked</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;yes&#39;</span><span class="w"> </span><span class="p">});</span><span class="w"> </span><span class="c1">// Invalid type for isLocked</span>
<a id="__codelineno-27-16" name="__codelineno-27-16" href="#__codelineno-27-16"></a><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-27-17" name="__codelineno-27-17" href="#__codelineno-27-17"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Invalid lock status:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
<a id="__codelineno-27-18" name="__codelineno-27-18" href="#__codelineno-27-18"></a><span class="p">}</span>
</code></pre></div>
<h4 id="tojson-object"><code>toJSON(): Object</code><a class="headerlink" href="#tojson-object" title="Permanent link">&para;</a></h4>
<p>Returns the metadata as a plain JavaScript object, suitable for <code>JSON.stringify()</code>. This method includes a <code>__type</code> property for potential deserialisation and ensures all date properties are new <code>Date</code> instances.</p>
<ul>
<li><strong>Returns</strong>: A plain object with all metadata properties:
  <code>{ __type: 'CollectionMetadata', name: string, fileId: string, created: Date, lastUpdated: Date, documentCount: number, modificationToken: string|null, lockStatus: Object|null }</code></li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">metadata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">CollectionMetadata</span><span class="p">(</span><span class="s1">&#39;dataEntries&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;dataFileId1&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="w">  </span><span class="nx">documentCount</span><span class="o">:</span><span class="w"> </span><span class="mf">10</span><span class="p">,</span>
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="w">  </span><span class="nx">modificationToken</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;token-xyz&#39;</span>
<a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="p">});</span>
<a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="kd">const</span><span class="w"> </span><span class="nx">obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">metadata</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">();</span>
<a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a>
<a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Plain object:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">obj</span><span class="p">);</span>
<a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a><span class="cm">/*</span>
<a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a><span class="cm">{</span>
<a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a><span class="cm">  __type: &#39;CollectionMetadata&#39;,</span>
<a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a><span class="cm">  name: &#39;dataEntries&#39;,</span>
<a id="__codelineno-28-12" name="__codelineno-28-12" href="#__codelineno-28-12"></a><span class="cm">  fileId: &#39;dataFileId1&#39;,</span>
<a id="__codelineno-28-13" name="__codelineno-28-13" href="#__codelineno-28-13"></a><span class="cm">  created: Date, // (a new Date instance)</span>
<a id="__codelineno-28-14" name="__codelineno-28-14" href="#__codelineno-28-14"></a><span class="cm">  lastUpdated: Date, // (a new Date instance)</span>
<a id="__codelineno-28-15" name="__codelineno-28-15" href="#__codelineno-28-15"></a><span class="cm">  documentCount: 10,</span>
<a id="__codelineno-28-16" name="__codelineno-28-16" href="#__codelineno-28-16"></a><span class="cm">  modificationToken: &#39;token-xyz&#39;,</span>
<a id="__codelineno-28-17" name="__codelineno-28-17" href="#__codelineno-28-17"></a><span class="cm">  lockStatus: null</span>
<a id="__codelineno-28-18" name="__codelineno-28-18" href="#__codelineno-28-18"></a><span class="cm">}</span>
<a id="__codelineno-28-19" name="__codelineno-28-19" href="#__codelineno-28-19"></a><span class="cm">*/</span>
<a id="__codelineno-28-20" name="__codelineno-28-20" href="#__codelineno-28-20"></a>
<a id="__codelineno-28-21" name="__codelineno-28-21" href="#__codelineno-28-21"></a><span class="c1">// Dates are independent copies</span>
<a id="__codelineno-28-22" name="__codelineno-28-22" href="#__codelineno-28-22"></a><span class="kd">const</span><span class="w"> </span><span class="nx">originalCreationYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">metadata</span><span class="p">.</span><span class="nx">created</span><span class="p">.</span><span class="nx">getFullYear</span><span class="p">();</span>
<a id="__codelineno-28-23" name="__codelineno-28-23" href="#__codelineno-28-23"></a><span class="nx">obj</span><span class="p">.</span><span class="nx">created</span><span class="p">.</span><span class="nx">setFullYear</span><span class="p">(</span><span class="mf">2000</span><span class="p">);</span>
<a id="__codelineno-28-24" name="__codelineno-28-24" href="#__codelineno-28-24"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
<a id="__codelineno-28-25" name="__codelineno-28-25" href="#__codelineno-28-25"></a><span class="w">  </span><span class="s1">&#39;Original created year unchanged:&#39;</span><span class="p">,</span>
<a id="__codelineno-28-26" name="__codelineno-28-26" href="#__codelineno-28-26"></a><span class="w">  </span><span class="nx">metadata</span><span class="p">.</span><span class="nx">created</span><span class="p">.</span><span class="nx">getFullYear</span><span class="p">()</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">originalCreationYear</span>
<a id="__codelineno-28-27" name="__codelineno-28-27" href="#__codelineno-28-27"></a><span class="p">);</span><span class="w"> </span><span class="c1">// true</span>
</code></pre></div>
<h4 id="clone-collectionmetadata"><code>clone(): CollectionMetadata</code><a class="headerlink" href="#clone-collectionmetadata" title="Permanent link">&para;</a></h4>
<p>Creates and returns a new <code>CollectionMetadata</code> instance that is an independent, deep copy of the original.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">original</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">CollectionMetadata</span><span class="p">(</span><span class="s1">&#39;source&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;sourceFile&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">documentCount</span><span class="o">:</span><span class="w"> </span><span class="mf">5</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">copy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">original</span><span class="p">.</span><span class="nx">clone</span><span class="p">();</span>
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a>
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="nx">copy</span><span class="p">.</span><span class="nx">incrementDocumentCount</span><span class="p">();</span>
<a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Original unchanged:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">original</span><span class="p">.</span><span class="nx">documentCount</span><span class="p">);</span><span class="w"> </span><span class="c1">// 5</span>
<a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Copy changed:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">copy</span><span class="p">.</span><span class="nx">documentCount</span><span class="p">);</span><span class="w"> </span><span class="c1">// 6</span>
<a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a>
<a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a><span class="c1">// Ensure deep copy of nested objects like lockStatus if present</span>
<a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a><span class="kd">const</span><span class="w"> </span><span class="nx">lock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">isLocked</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nx">lockedBy</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;test&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">lockedAt</span><span class="o">:</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">(),</span><span class="w"> </span><span class="nx">lockTimeout</span><span class="o">:</span><span class="w"> </span><span class="mf">1000</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a><span class="kd">const</span><span class="w"> </span><span class="nx">originalWithLock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">CollectionMetadata</span><span class="p">(</span><span class="s1">&#39;lockedColl&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;lockFile&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">lockStatus</span><span class="o">:</span><span class="w"> </span><span class="nx">lock</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-29-11" name="__codelineno-29-11" href="#__codelineno-29-11"></a><span class="kd">const</span><span class="w"> </span><span class="nx">copyWithLock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">originalWithLock</span><span class="p">.</span><span class="nx">clone</span><span class="p">();</span>
<a id="__codelineno-29-12" name="__codelineno-29-12" href="#__codelineno-29-12"></a><span class="nx">copyWithLock</span><span class="p">.</span><span class="nx">getLockStatus</span><span class="p">().</span><span class="nx">isLocked</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<a id="__codelineno-29-13" name="__codelineno-29-13" href="#__codelineno-29-13"></a>
<a id="__codelineno-29-14" name="__codelineno-29-14" href="#__codelineno-29-14"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Original lock status unchanged:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">originalWithLock</span><span class="p">.</span><span class="nx">getLockStatus</span><span class="p">().</span><span class="nx">isLocked</span><span class="p">);</span><span class="w"> </span><span class="c1">// true</span>
<a id="__codelineno-29-15" name="__codelineno-29-15" href="#__codelineno-29-15"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Copy lock status changed:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">copyWithLock</span><span class="p">.</span><span class="nx">getLockStatus</span><span class="p">().</span><span class="nx">isLocked</span><span class="p">);</span><span class="w"> </span><span class="c1">// false</span>
</code></pre></div>
<h3 id="static-methods">Static Methods<a class="headerlink" href="#static-methods" title="Permanent link">&para;</a></h3>
<h4 id="static-fromjsonobj-object-collectionmetadata"><code>static fromJSON(obj: Object): CollectionMetadata</code><a class="headerlink" href="#static-fromjsonobj-object-collectionmetadata" title="Permanent link">&para;</a></h4>
<p>Creates a <code>CollectionMetadata</code> instance from a plain JavaScript object (typically one produced by <code>toJSON()</code>).</p>
<ul>
<li><strong>Parameters</strong>:</li>
<li><code>obj</code>: A plain object containing metadata properties.</li>
<li><strong>Returns</strong>: A new <code>CollectionMetadata</code> instance.</li>
<li><strong>Throws</strong>: <code>InvalidArgumentError</code> if the input object is invalid or missing required properties.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">plainObject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;deserialisedCollection&#39;</span><span class="p">,</span>
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="w">  </span><span class="nx">fileId</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;deserialisedFileId&#39;</span><span class="p">,</span>
<a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a><span class="w">  </span><span class="nx">created</span><span class="o">:</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2022-01-01T10:00:00Z&#39;</span><span class="p">).</span><span class="nx">toISOString</span><span class="p">(),</span><span class="w"> </span><span class="c1">// Dates can be ISO strings or Date objects</span>
<a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a><span class="w">  </span><span class="nx">lastUpdated</span><span class="o">:</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2022-01-02T11:00:00Z&#39;</span><span class="p">),</span>
<a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a><span class="w">  </span><span class="nx">documentCount</span><span class="o">:</span><span class="w"> </span><span class="mf">15</span><span class="p">,</span>
<a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a><span class="w">  </span><span class="nx">modificationToken</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;tokenFromObject&#39;</span><span class="p">,</span>
<a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a><span class="w">  </span><span class="nx">lockStatus</span><span class="o">:</span><span class="w"> </span><span class="kc">null</span>
<a id="__codelineno-30-9" name="__codelineno-30-9" href="#__codelineno-30-9"></a><span class="p">};</span>
<a id="__codelineno-30-10" name="__codelineno-30-10" href="#__codelineno-30-10"></a>
<a id="__codelineno-30-11" name="__codelineno-30-11" href="#__codelineno-30-11"></a><span class="c1">// Note: For fromJSON to correctly parse date strings, they should be in a format</span>
<a id="__codelineno-30-12" name="__codelineno-30-12" href="#__codelineno-30-12"></a><span class="c1">// that the Date constructor can parse, or be actual Date objects.</span>
<a id="__codelineno-30-13" name="__codelineno-30-13" href="#__codelineno-30-13"></a><span class="c1">// The constructor of CollectionMetadata handles new Date(value) for date fields.</span>
<a id="__codelineno-30-14" name="__codelineno-30-14" href="#__codelineno-30-14"></a>
<a id="__codelineno-30-15" name="__codelineno-30-15" href="#__codelineno-30-15"></a><span class="kd">const</span><span class="w"> </span><span class="nx">metadataInstance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CollectionMetadata</span><span class="p">.</span><span class="nx">fromJSON</span><span class="p">(</span><span class="nx">plainObject</span><span class="p">);</span>
<a id="__codelineno-30-16" name="__codelineno-30-16" href="#__codelineno-30-16"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Instance name:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">metadataInstance</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span><span class="w"> </span><span class="c1">// &#39;deserialisedCollection&#39;</span>
<a id="__codelineno-30-17" name="__codelineno-30-17" href="#__codelineno-30-17"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Instance document count:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">metadataInstance</span><span class="p">.</span><span class="nx">documentCount</span><span class="p">);</span><span class="w"> </span><span class="c1">// 15</span>
<a id="__codelineno-30-18" name="__codelineno-30-18" href="#__codelineno-30-18"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Instance modification token:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">metadataInstance</span><span class="p">.</span><span class="nx">getModificationToken</span><span class="p">());</span><span class="w"> </span><span class="c1">// &#39;tokenFromObject&#39;</span>
</code></pre></div>
<h4 id="static-createname-string-fileid-string-collectionmetadata"><code>static create(name: string, fileId: string): CollectionMetadata</code><a class="headerlink" href="#static-createname-string-fileid-string-collectionmetadata" title="Permanent link">&para;</a></h4>
<p>A static factory method to create a new <code>CollectionMetadata</code> instance with the specified <code>name</code> and <code>fileId</code>, and default values for other properties.</p>
<ul>
<li><strong>Parameters</strong>:</li>
<li><code>name</code>: The collection name.</li>
<li><code>fileId</code>: The Google Drive file ID.</li>
<li><strong>Returns</strong>: A new <code>CollectionMetadata</code> instance.</li>
<li><strong>Throws</strong>: <code>InvalidArgumentError</code> if <code>name</code> or <code>fileId</code> are invalid.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">newMetadata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CollectionMetadata</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s1">&#39;newCollection&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;newFileIdXYZ&#39;</span><span class="p">);</span>
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Created name:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">newMetadata</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span><span class="w"> </span><span class="c1">// &#39;newCollection&#39;</span>
<a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Created fileId:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">newMetadata</span><span class="p">.</span><span class="nx">fileId</span><span class="p">);</span><span class="w"> </span><span class="c1">// &#39;newFileIdXYZ&#39;</span>
<a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Created doc count:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">newMetadata</span><span class="p">.</span><span class="nx">documentCount</span><span class="p">);</span><span class="w"> </span><span class="c1">// 0</span>
</code></pre></div>
<hr />
<h2 id="documentoperations">DocumentOperations<a class="headerlink" href="#documentoperations" title="Permanent link">&para;</a></h2>
<h3 id="purpose_2">Purpose<a class="headerlink" href="#purpose_2" title="Permanent link">&para;</a></h3>
<p><code>DocumentOperations</code> is a low-level component responsible for the direct manipulation of documents within a collection's in-memory representation. It provides the core Create, Read, Update, and Delete (CRUD) functionalities that are utilised by the higher-level <code>Collection</code> class. <code>DocumentOperations</code> itself does not interact with the file system or manage metadata; its focus is solely on operating on the JavaScript objects that represent documents.</p>
<p>It works in conjunction with:</p>
<ul>
<li><strong>Collection</strong>: The <code>Collection</code> class instantiates and uses <code>DocumentOperations</code> to perform actions on its <code>_documents</code> object.</li>
<li><strong>QueryEngine</strong>: For <code>findByQuery</code>, <code>findMultipleByQuery</code>, and <code>countByQuery</code> methods, <code>DocumentOperations</code> delegates the filtering logic to the <code>QueryEngine</code>.</li>
<li><strong>UpdateEngine</strong>: For <code>updateDocumentWithOperators</code> and <code>updateDocumentByQuery</code> methods, <code>DocumentOperations</code> uses the <code>UpdateEngine</code> to apply complex update operations.</li>
</ul>
<h3 id="constructor_2">Constructor<a class="headerlink" href="#constructor_2" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="ow">new</span><span class="w"> </span><span class="nx">DocumentOperations</span><span class="p">(</span><span class="nx">collection</span><span class="p">);</span>
</code></pre></div>
<ul>
<li><strong>collection</strong>: A reference to the <code>Collection</code> instance. This provides <code>DocumentOperations</code> access to the actual documents array (<code>collection._documents</code>) and methods to update metadata (<code>collection._updateMetadata()</code>) and mark the collection as dirty (<code>collection._markDirty()</code>).</li>
</ul>
<p><strong>Throws</strong>: <code>InvalidArgumentError</code> if the <code>collection</code> parameter is not a valid <code>Collection</code> instance (though this is typically ensured by the <code>Collection</code> class itself).</p>
<p><strong>Example:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="c1">// Typically created by the Collection class, not directly</span>
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="c1">// Assuming &#39;this&#39; is an instance of the Collection class</span>
<a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a><span class="k">this</span><span class="p">.</span><span class="nx">_documentOperations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">DocumentOperations</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</code></pre></div>
<h3 id="public-methods_2">Public Methods<a class="headerlink" href="#public-methods_2" title="Permanent link">&para;</a></h3>
<h4 id="insertdocumentdoc-object-object">insertDocument(doc: Object): Object<a class="headerlink" href="#insertdocumentdoc-object-object" title="Permanent link">&para;</a></h4>
<p>Inserts a single document into the collection's internal <code>_documents</code> object. If the document does not have an <code>_id</code> field, one is generated.</p>
<ul>
<li><strong>Parameters</strong></li>
<li><code>doc</code>: The document object to insert.</li>
<li><strong>Returns</strong></li>
<li>The inserted document, including its <code>_id</code>.</li>
<li><strong>Throws</strong></li>
<li><code>ErrorHandler.ErrorTypes.INVALID_ARGUMENT</code>: If the document is invalid (e.g., <code>null</code>, not an object, or contains invalid field names).</li>
<li><code>ErrorHandler.ErrorTypes.CONFLICT_ERROR</code>: If a document with the same <code>_id</code> already exists.</li>
</ul>
<p><strong>Example:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="c1">// Assuming docOps is an instance of DocumentOperations</span>
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">newDoc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">docOps</span><span class="p">.</span><span class="nx">insertDocument</span><span class="p">({</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Alice&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">age</span><span class="o">:</span><span class="w"> </span><span class="mf">30</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Inserted document ID:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">newDoc</span><span class="p">.</span><span class="nx">_id</span><span class="p">);</span>
<a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a>
<a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a><span class="w">  </span><span class="nx">docOps</span><span class="p">.</span><span class="nx">insertDocument</span><span class="p">({</span><span class="w"> </span><span class="nx">_id</span><span class="o">:</span><span class="w"> </span><span class="nx">newDoc</span><span class="p">.</span><span class="nx">_id</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Bob&#39;</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span><span class="w"> </span><span class="c1">// Conflict error</span>
<a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a><span class="p">}</span>
</code></pre></div>
<h4 id="finddocumentbyidid-string-objectnull">findDocumentById(id: string): Object|null<a class="headerlink" href="#finddocumentbyidid-string-objectnull" title="Permanent link">&para;</a></h4>
<p>Retrieves a document by its <code>_id</code>.</p>
<ul>
<li><strong>Parameters</strong></li>
<li><code>id</code>: The <code>_id</code> of the document to find.</li>
<li><strong>Returns</strong></li>
<li>The found document object, or <code>null</code> if no document with that <code>_id</code> exists.</li>
<li><strong>Throws</strong></li>
<li><code>ErrorHandler.ErrorTypes.INVALID_ARGUMENT</code>: If the <code>id</code> is invalid (e.g., not a string or empty).</li>
</ul>
<p><strong>Example:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">docOps</span><span class="p">.</span><span class="nx">findDocumentById</span><span class="p">(</span><span class="s1">&#39;some-unique-id&#39;</span><span class="p">);</span>
<a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">user</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Found user:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
<a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;User not found.&#39;</span><span class="p">);</span>
<a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a><span class="p">}</span>
</code></pre></div>
<h4 id="findalldocuments-arrayobject">findAllDocuments(): Array&lt;Object&gt;<a class="headerlink" href="#findalldocuments-arrayobject" title="Permanent link">&para;</a></h4>
<p>Retrieves all documents currently held in the collection's <code>_documents</code> object.</p>
<ul>
<li><strong>Returns</strong></li>
<li>An array of all document objects. Returns an empty array if the collection is empty.</li>
</ul>
<p><strong>Example:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">allUsers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">docOps</span><span class="p">.</span><span class="nx">findAllDocuments</span><span class="p">();</span>
<a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`There are </span><span class="si">${</span><span class="nx">allUsers</span><span class="p">.</span><span class="nx">length</span><span class="si">}</span><span class="sb"> users.`</span><span class="p">);</span>
</code></pre></div>
<h4 id="updatedocumentid-string-updatedata-object-object">updateDocument(id: string, updateData: Object): Object<a class="headerlink" href="#updatedocumentid-string-updatedata-object-object" title="Permanent link">&para;</a></h4>
<p>Replaces the entire document identified by <code>id</code> with <code>updateData</code>. This is a full replacement, not a partial update. The <code>_id</code> in <code>updateData</code> must match the <code>id</code> parameter if provided, or <code>updateData</code> should not contain an <code>_id</code> (in which case the original <code>_id</code> is preserved).</p>
<ul>
<li><strong>Parameters</strong></li>
<li><code>id</code>: The <code>_id</code> of the document to update.</li>
<li><code>updateData</code>: The new document data.</li>
<li><strong>Returns</strong></li>
<li>An object <code>{ acknowledged: boolean, modifiedCount: number }</code>. <code>modifiedCount</code> is 1 if the document was found and updated, 0 otherwise.</li>
<li><strong>Throws</strong></li>
<li><code>ErrorHandler.ErrorTypes.INVALID_ARGUMENT</code>: If <code>id</code> or <code>updateData</code> is invalid, or if <code>updateData._id</code> is present and does not match <code>id</code>.</li>
<li><code>ErrorHandler.ErrorTypes.DOCUMENT_NOT_FOUND</code>: If no document with the given <code>id</code> exists. (Note: current implementation returns <code>modifiedCount: 0</code> instead of throwing)</li>
</ul>
<p><strong>Example:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">docOps</span><span class="p">.</span><span class="nx">updateDocument</span><span class="p">(</span><span class="s1">&#39;some-unique-id&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Alice Smith&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">age</span><span class="o">:</span><span class="w"> </span><span class="mf">31</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">modifiedCount</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Document updated.&#39;</span><span class="p">);</span>
<a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Document not found or not modified.&#39;</span><span class="p">);</span>
<a id="__codelineno-37-6" name="__codelineno-37-6" href="#__codelineno-37-6"></a><span class="p">}</span>
</code></pre></div>
<h4 id="deletedocumentid-string-object">deleteDocument(id: string): Object<a class="headerlink" href="#deletedocumentid-string-object" title="Permanent link">&para;</a></h4>
<p>Deletes a document by its <code>_id</code>.</p>
<ul>
<li><strong>Parameters</strong></li>
<li><code>id</code>: The <code>_id</code> of the document to delete.</li>
<li><strong>Returns</strong></li>
<li>An object <code>{ acknowledged: boolean, deletedCount: number }</code>. <code>deletedCount</code> is 1 if the document was found and deleted, 0 otherwise.</li>
<li><strong>Throws</strong></li>
<li><code>ErrorHandler.ErrorTypes.INVALID_ARGUMENT</code>: If the <code>id</code> is invalid.</li>
</ul>
<p><strong>Example:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">docOps</span><span class="p">.</span><span class="nx">deleteDocument</span><span class="p">(</span><span class="s1">&#39;some-unique-id&#39;</span><span class="p">);</span>
<a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">deletedCount</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Document deleted.&#39;</span><span class="p">);</span>
<a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Document not found.&#39;</span><span class="p">);</span>
<a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a><span class="p">}</span>
</code></pre></div>
<h4 id="countdocuments-number">countDocuments(): number<a class="headerlink" href="#countdocuments-number" title="Permanent link">&para;</a></h4>
<p>Counts the total number of documents in the collection.</p>
<ul>
<li><strong>Returns</strong></li>
<li>The total number of documents.</li>
</ul>
<p><strong>Example:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">docOps</span><span class="p">.</span><span class="nx">countDocuments</span><span class="p">();</span>
<a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Total documents: </span><span class="si">${</span><span class="nx">count</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</code></pre></div>
<h4 id="documentexistsid-string-boolean">documentExists(id: string): boolean<a class="headerlink" href="#documentexistsid-string-boolean" title="Permanent link">&para;</a></h4>
<p>Checks if a document with the given <code>_id</code> exists.</p>
<ul>
<li><strong>Parameters</strong></li>
<li><code>id</code>: The <code>_id</code> to check.</li>
<li><strong>Returns</strong></li>
<li><code>true</code> if a document with the <code>_id</code> exists, <code>false</code> otherwise.</li>
<li><strong>Throws</strong></li>
<li><code>ErrorHandler.ErrorTypes.INVALID_ARGUMENT</code>: If the <code>id</code> is invalid.</li>
</ul>
<p><strong>Example:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">docOps</span><span class="p">.</span><span class="nx">documentExists</span><span class="p">(</span><span class="s1">&#39;some-unique-id&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Document exists.&#39;</span><span class="p">);</span>
<a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a><span class="p">}</span>
</code></pre></div>
<h4 id="findbyqueryquery-object-objectnull">findByQuery(query: Object): Object|null<a class="headerlink" href="#findbyqueryquery-object-objectnull" title="Permanent link">&para;</a></h4>
<p>Finds the first document that matches the given query. Delegates to <code>QueryEngine</code>.</p>
<ul>
<li><strong>Parameters</strong></li>
<li><code>query</code>: A MongoDB-compatible query object.</li>
<li><strong>Returns</strong></li>
<li>The first matching document, or <code>null</code> if no documents match.</li>
<li><strong>Throws</strong></li>
<li><code>ErrorHandler.ErrorTypes.INVALID_ARGUMENT</code>: If the query is invalid.</li>
<li><code>ErrorHandler.ErrorTypes.INVALID_QUERY</code>: If the query contains invalid operators (as determined by <code>QueryEngine</code>).</li>
</ul>
<p><strong>Example:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">docOps</span><span class="p">.</span><span class="nx">findByQuery</span><span class="p">({</span><span class="w"> </span><span class="nx">age</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">$gt</span><span class="o">:</span><span class="w"> </span><span class="mf">30</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">user</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Found user older than 30:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
<a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a><span class="p">}</span>
</code></pre></div>
<h4 id="findmultiplebyqueryquery-object-arrayobject">findMultipleByQuery(query: Object): Array&lt;Object&gt;<a class="headerlink" href="#findmultiplebyqueryquery-object-arrayobject" title="Permanent link">&para;</a></h4>
<p>Finds all documents that match the given query. Delegates to <code>QueryEngine</code>.</p>
<ul>
<li><strong>Parameters</strong></li>
<li><code>query</code>: A MongoDB-compatible query object.</li>
<li><strong>Returns</strong></li>
<li>An array of matching documents. Returns an empty array if no documents match.</li>
<li><strong>Throws</strong></li>
<li><code>ErrorHandler.ErrorTypes.INVALID_ARGUMENT</code>: If the query is invalid.</li>
<li><code>ErrorHandler.ErrorTypes.INVALID_QUERY</code>: If the query contains invalid operators.</li>
</ul>
<p><strong>Example:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">admins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">docOps</span><span class="p">.</span><span class="nx">findMultipleByQuery</span><span class="p">({</span><span class="w"> </span><span class="nx">role</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;admin&#39;</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a><span class="nx">admins</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">admin</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">admin</span><span class="p">.</span><span class="nx">name</span><span class="p">));</span>
</code></pre></div>
<h4 id="countbyqueryquery-object-number">countByQuery(query: Object): number<a class="headerlink" href="#countbyqueryquery-object-number" title="Permanent link">&para;</a></h4>
<p>Counts documents that match the given query. Delegates to <code>QueryEngine</code>.</p>
<ul>
<li><strong>Parameters</strong></li>
<li><code>query</code>: A MongoDB-compatible query object.</li>
<li><strong>Returns</strong></li>
<li>The number of matching documents.</li>
<li><strong>Throws</strong></li>
<li><code>ErrorHandler.ErrorTypes.INVALID_ARGUMENT</code>: If the query is invalid.</li>
<li><code>ErrorHandler.ErrorTypes.INVALID_QUERY</code>: If the query contains invalid operators.</li>
</ul>
<p><strong>Example:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">activeUserCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">docOps</span><span class="p">.</span><span class="nx">countByQuery</span><span class="p">({</span><span class="w"> </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;active&#39;</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Number of active users: </span><span class="si">${</span><span class="nx">activeUserCount</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</code></pre></div>
<h4 id="updatedocumentwithoperatorsid-string-updateops-object-object">updateDocumentWithOperators(id: string, updateOps: Object): Object<a class="headerlink" href="#updatedocumentwithoperatorsid-string-updateops-object-object" title="Permanent link">&para;</a></h4>
<p>Updates a single document identified by <code>id</code> using MongoDB-style update operators (e.g., <code>$set</code>, <code>$inc</code>). Delegates to <code>UpdateEngine</code>.</p>
<ul>
<li><strong>Parameters</strong></li>
<li><code>id</code>: The <code>_id</code> of the document to update.</li>
<li><code>updateOps</code>: An object containing update operator instructions.</li>
<li><strong>Returns</strong></li>
<li>An object <code>{ acknowledged: boolean, modifiedCount: number }</code>.</li>
<li><strong>Throws</strong></li>
<li><code>ErrorHandler.ErrorTypes.INVALID_ARGUMENT</code>: If <code>id</code> or <code>updateOps</code> are invalid.</li>
<li><code>ErrorHandler.ErrorTypes.DOCUMENT_NOT_FOUND</code>: If no document with the given <code>id</code> exists.</li>
<li><code>ErrorHandler.ErrorTypes.INVALID_QUERY</code>: If <code>updateOps</code> are invalid (as determined by <code>UpdateEngine</code>).</li>
</ul>
<p><strong>Example:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">docOps</span><span class="p">.</span><span class="nx">updateDocumentWithOperators</span><span class="p">(</span><span class="s1">&#39;some-unique-id&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a><span class="w">  </span><span class="nx">$set</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;inactive&#39;</span><span class="w"> </span><span class="p">},</span>
<a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a><span class="w">  </span><span class="nx">$inc</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">loginAttempts</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a><span class="p">});</span>
<a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">modifiedCount</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-44-6" name="__codelineno-44-6" href="#__codelineno-44-6"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Document updated with operators.&#39;</span><span class="p">);</span>
<a id="__codelineno-44-7" name="__codelineno-44-7" href="#__codelineno-44-7"></a><span class="p">}</span>
</code></pre></div>
<h4 id="updatedocumentbyqueryquery-object-updateops-object-number">updateDocumentByQuery(query: Object, updateOps: Object): number<a class="headerlink" href="#updatedocumentbyqueryquery-object-updateops-object-number" title="Permanent link">&para;</a></h4>
<p>Updates all documents matching the <code>query</code> using MongoDB-style update operators. Delegates to <code>QueryEngine</code> for finding documents and <code>UpdateEngine</code> for applying updates.</p>
<ul>
<li><strong>Parameters</strong></li>
<li><code>query</code>: The filter criteria to select documents for update.</li>
<li><code>updateOps</code>: The update operator instructions.</li>
<li><strong>Returns</strong></li>
<li>The number of documents modified.</li>
<li><strong>Throws</strong></li>
<li><code>ErrorHandler.ErrorTypes.INVALID_ARGUMENT</code>: If <code>query</code> or <code>updateOps</code> are invalid.</li>
<li><code>ErrorHandler.ErrorTypes.INVALID_QUERY</code>: If <code>updateOps</code> are invalid.
    (Note: <code>DOCUMENT_NOT_FOUND</code> is listed in JSDoc but typically results in 0 modified documents rather than an error for "update many" type operations).</li>
</ul>
<p><strong>Example:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">updatedCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">docOps</span><span class="p">.</span><span class="nx">updateDocumentByQuery</span><span class="p">(</span>
<a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nx">department</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Sales&#39;</span><span class="w"> </span><span class="p">},</span>
<a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nx">$set</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">onQuota</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a><span class="p">);</span>
<a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">updatedCount</span><span class="si">}</span><span class="sb"> sales documents updated.`</span><span class="p">);</span>
</code></pre></div>
<h4 id="replacedocumentid-string-doc-object-object">replaceDocument(id: string, doc: Object): Object<a class="headerlink" href="#replacedocumentid-string-doc-object-object" title="Permanent link">&para;</a></h4>
<p>Replaces a single document identified by <code>id</code> with the new <code>doc</code>. The <code>_id</code> in <code>doc</code> must match <code>id</code> or be omitted.</p>
<ul>
<li><strong>Parameters</strong></li>
<li><code>id</code>: The <code>_id</code> of the document to replace.</li>
<li><code>doc</code>: The replacement document.</li>
<li><strong>Returns</strong></li>
<li>An object <code>{ acknowledged: boolean, modifiedCount: number }</code>.</li>
<li><strong>Throws</strong></li>
<li><code>ErrorHandler.ErrorTypes.INVALID_ARGUMENT</code>: If <code>id</code> or <code>doc</code> is invalid, or if <code>doc._id</code> is present and mismatches <code>id</code>.</li>
<li><code>ErrorHandler.ErrorTypes.DOCUMENT_NOT_FOUND</code>: If no document with the given <code>id</code> exists.</li>
</ul>
<p><strong>Example:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">docOps</span><span class="p">.</span><span class="nx">replaceDocument</span><span class="p">(</span><span class="s1">&#39;some-unique-id&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;New Name&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;New Value&#39;</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">modifiedCount</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Document replaced.&#39;</span><span class="p">);</span>
<a id="__codelineno-46-4" name="__codelineno-46-4" href="#__codelineno-46-4"></a><span class="p">}</span>
</code></pre></div>
<h4 id="replacedocumentbyqueryquery-object-doc-object-number">replaceDocumentByQuery(query: Object, doc: Object): number<a class="headerlink" href="#replacedocumentbyqueryquery-object-doc-object-number" title="Permanent link">&para;</a></h4>
<p>Replaces the first document matching the <code>query</code> with the new <code>doc</code>. Note: MongoDB's <code>replaceOne</code> is more aligned with <code>replaceDocument</code>. This method's name might be slightly misleading if it replaces multiple, but the current implementation seems to target one. If it's intended to replace multiple, the return type and logic would differ. Assuming it replaces one based on typical <code>replace</code> semantics.</p>
<ul>
<li><strong>Parameters</strong></li>
<li><code>query</code>: The filter criteria to select the document for replacement.</li>
<li><code>doc</code>: The replacement document.</li>
<li><strong>Returns</strong></li>
<li>The number of documents replaced (0 or 1).</li>
<li><strong>Throws</strong></li>
<li><code>ErrorHandler.ErrorTypes.INVALID_ARGUMENT</code>: If <code>query</code> or <code>doc</code> is invalid.</li>
</ul>
<p><strong>Example:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">replacedCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">docOps</span><span class="p">.</span><span class="nx">replaceDocumentByQuery</span><span class="p">(</span>
<a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;pending&#39;</span><span class="w"> </span><span class="p">},</span>
<a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;approved&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">approvedBy</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;admin&#39;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a><span class="p">);</span>
<a id="__codelineno-47-5" name="__codelineno-47-5" href="#__codelineno-47-5"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">replacedCount</span><span class="si">}</span><span class="sb"> document(s) replaced.`</span><span class="p">);</span>
</code></pre></div>
<h3 id="private-methods">Private Methods<a class="headerlink" href="#private-methods" title="Permanent link">&para;</a></h3>
<p><code>DocumentOperations</code> includes several private helper methods for validation, ID generation, and query orchestration:</p>
<p><strong>Validation &amp; ID Generation:</strong></p>
<ul>
<li><code>_generateDocumentId()</code>: Generates a unique ID for new documents.</li>
<li><code>_validateDocument(doc)</code>: Validates the overall document structure and content.</li>
<li><code>_validateDocumentId(id)</code>: Validates a standalone document ID.</li>
<li><code>_validateDocumentIdInDocument(id, doc)</code>: Validates an <code>_id</code> field within a document.</li>
<li><code>_validateDocumentFields(doc)</code>: Validates field names within a document.</li>
<li><code>_checkDuplicateId(id)</code>: Ensures an <code>_id</code> is not already in use before insertion.</li>
<li><code>_validateQuery(query)</code>: Basic validation for query objects.</li>
<li><code>_validateUpdateOperators(updateOps)</code>: Basic validation for update operator objects.</li>
</ul>
<p><strong>Query Execution (D1 Refactoring):</strong></p>
<ul>
<li><code>_executeQuery(query, operation)</code>: Consolidates query validation, document retrieval, QueryEngine execution, and logging. Used by <code>findByQuery()</code>, <code>findMultipleByQuery()</code>, and <code>countByQuery()</code>.</li>
</ul>
<p><strong>Bulk Operations (D2 Refactoring):</strong></p>
<ul>
<li><code>_applyToMatchingDocuments(query, applyFn, throwIfNoMatches)</code>: Unifies match/apply pattern for query-based bulk operations. Finds matching documents, applies callback function, and accumulates affected count. Used by <code>updateDocumentByQuery()</code> and <code>replaceDocumentByQuery()</code>.</li>
</ul>
<p>These private methods ensure data integrity, consistent error handling, and DRY principles within the component.</p>
<hr />












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../UpdateEngine/" class="md-footer__link md-footer__link--prev" aria-label="Previous: UpdateEngine">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                UpdateEngine
              </div>
            </div>
          </a>
        
        
          
          <a href="../Infrastructure_Components/" class="md-footer__link md-footer__link--next" aria-label="Next: Infrastructure Components">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Infrastructure Components
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/h-arnold/JsonDbApp" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.tabs", "navigation.sections", "navigation.top", "navigation.footer", "search.suggest", "search.highlight", "content.code.copy", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>